<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico Empresarial Inteligente PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Cores para o tema claro - Melhor contraste */
            --light-bg: #ffffff; 
            --light-card-bg: rgba(249, 250, 251, 0.95); 
            --light-text-primary: #111827; 
            --light-text-secondary: #374151; 
            --light-text-tertiary: #6b7280; 
            --light-border: #d1d5db; 
            --light-input-bg: #ffffff;
            --light-input-border: #cbd5e1; 
            
            /* Cores para o tema escuro */
            --dark-bg: #0d1117;  
            --dark-card-bg: rgba(22, 27, 34, 0.95); 
            --dark-text-primary: #e6edf3;  
            --dark-text-secondary: #909dab; 
            --dark-text-tertiary: #768390;
            --dark-border: #30363d;  
            --dark-input-bg: #161b22;
            --dark-input-border: #4b5563; 

            /* Gradientes de bot√µes vibrantes */
            --accent-gradient-start: #4f46e5; 
            --accent-gradient-end: #a855f7;   
            --success-gradient-start: #16a34a; 
            --success-gradient-end: #10b981;   

            /* Cores para o Relat√≥rio e √≠cones */
            --color-perigo: #ef4444;       /* red-500 */
            --color-oportunidade: #f59e0b; /* amber-500 */
            --color-desafio: #f97316;      /* orange-500 */
            --color-solucao: #22c55e;      /* green-500 */
            --color-explorar: #3b82f6;     /* blue-500 */
            --color-apontamento: #6366f1;  /* indigo-500 - Para "Apontamentos" se precisar de uma cor distinta */
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.4s, color 0.4s;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden; /* Prevenir scroll horizontal */
        }

        .hidden { display: none !important; }

        .light { background-color: var(--light-bg); color: var(--light-text-primary); }
        .dark { background-color: var(--dark-bg); color: var(--dark-text-primary); }

        .welcome-screen-bg { background-size: 250% 250%; animation: animatedGradientBG 30s ease infinite; }
        .light .welcome-screen-bg { background-image: linear-gradient(135deg, #e0e7ff, #f8fafc, #d1d8e0, #f8fafc, #e0e7ff); }
        .dark .welcome-screen-bg { background-image: linear-gradient(135deg, #1c2128, #0d1117, #21262d, #0d1117, #1c2128); }
        
        .animated-title-h1 { font-weight: 800; background-image: linear-gradient(100deg, var(--accent-gradient-start), var(--accent-gradient-end), var(--accent-gradient-start)); background-size: 200% auto; color: transparent; background-clip: text; -webkit-background-clip: text; animation: animatedTextGradient 7s linear infinite; }
        .animated-title-header { font-weight: 700; background-image: linear-gradient(100deg, var(--accent-gradient-start), var(--accent-gradient-end), var(--accent-gradient-start)); background-size: 200% auto; color: transparent; background-clip: text; -webkit-background-clip: text; animation: animatedTextGradient 9s linear infinite; }
        
        .glass-container { backdrop-filter: blur(18px) saturate(170%); -webkit-backdrop-filter: blur(18px) saturate(170%); border-radius: 1rem; }
        .light .glass-container { background-color: var(--light-card-bg); border: 1px solid var(--light-border); box-shadow: 0 8px 24px -8px rgba(108, 117, 125, 0.1), 0 16px 32px -16px rgba(108, 117, 125, 0.08); }
        .dark .glass-container { background-color: var(--dark-card-bg); border: 1px solid var(--dark-border); box-shadow: 0 8px 24px -8px rgba(0, 0, 0, 0.3), 0 16px 32px -16px rgba(0, 0, 0, 0.25); }
        
        .button-primary { background-image: linear-gradient(120deg, var(--accent-gradient-start) 0%, var(--accent-gradient-end) 100%); transition: all 0.4s ease; box-shadow: 0 4px 20px 0 rgba(168, 85, 247, 0.35); color:white; }
        .button-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 7px 25px 0 rgba(168, 85, 247, 0.5); }
        .button-success { background-image: linear-gradient(120deg, var(--success-gradient-start) 0%, var(--success-gradient-end) 100%); transition: all 0.4s ease; box-shadow: 0 4px 20px 0 rgba(22, 163, 74, 0.35); color:white; }
        .button-success:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 7px 25px 0 rgba(22, 163, 74, 0.5); }
        
        .light .button-secondary { background-color: #e5e7eb; color: var(--light-text-primary); border: 1px solid #d1d5db; } 
        .dark .button-secondary { background-color: #21262d; color: var(--dark-text-primary); border: 1px solid #30363d; } 
        .light .button-secondary:hover:not(:disabled) { background-color: #d1d5db; } 
        .dark .button-secondary:hover:not(:disabled) { background-color: #30363d; }
        
        .light input, .light textarea, .light select { background-color: var(--light-input-bg); border: 1px solid var(--light-input-border); color: var(--light-text-primary); } 
        .dark input, .dark textarea, .dark select { background-color: var(--dark-input-bg); border: 1px solid var(--dark-input-border); color: var(--dark-text-primary); } 
        .light input::placeholder, .light textarea::placeholder { color: var(--light-text-tertiary); } 
        .dark input::placeholder, .dark textarea::placeholder { color: var(--dark-text-tertiary); }
        .light input:focus, .light textarea:focus, .light select:focus { border-color: var(--accent-gradient-start); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2); outline: none; } 
        .dark input:focus, .dark textarea:focus, .dark select:focus { border-color: var(--accent-gradient-start); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.25); outline: none; }
        
        .report-item-card {
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-left-width: 5px;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            display: flex;
            align-items: flex-start;
        }
        .report-item-card:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 10px 20px -5px rgba(0,0,0,0.1);
        }
        .light .report-item-card { background-color: var(--light-card-bg); box-shadow: 0 4px 8px -2px rgba(0,0,0,0.07), 0 2px 6px -2px rgba(0,0,0,0.04); }
        .dark .report-item-card { background-color: var(--dark-card-bg); box-shadow: 0 4px 8px -2px rgba(0,0,0,0.25), 0 2px 6px -2px rgba(0,0,0,0.2); }
        .dark .report-item-card:hover { box-shadow: 0 10px 20px -5px rgba(0,0,0,0.35); }

        .report-item-icon {
            font-size: 1.75rem; /* Ajustado para melhor alinhamento com o texto */
            margin-right: 1rem;
            margin-top: 0.25rem; /* Pequeno ajuste para alinhar melhor com a primeira linha do t√≠tulo */
            flex-shrink: 0;
        }
        .report-item-content { flex-grow: 1; }
        .report-item-title { font-size: 1.125rem; font-weight: 600; margin-bottom: 0.35rem; }
        .report-item-description { font-size: 0.9rem; line-height: 1.65; }
        
        .light .report-item-title { color: var(--light-text-primary); }
        .dark .report-item-title { color: var(--dark-text-primary); }
        .light .report-item-description { color: var(--light-text-secondary); }
        .dark .report-item-description { color: var(--dark-text-secondary); }

        /* Cores espec√≠ficas para cada categoria no relat√≥rio em tela */
        .report-item-card.perigo { border-left-color: var(--color-perigo); }
        .report-item-card.perigo .report-item-icon { color: var(--color-perigo); }
        .report-item-card.oportunidade { border-left-color: var(--color-oportunidade); }
        .report-item-card.oportunidade .report-item-icon { color: var(--color-oportunidade); }
        .report-item-card.desafio { border-left-color: var(--color-desafio); }
        .report-item-card.desafio .report-item-icon { color: var(--color-desafio); }
        .report-item-card.solucao { border-left-color: var(--color-solucao); }
        .report-item-card.solucao .report-item-icon { color: var(--color-solucao); }
        .report-item-card.explorar { border-left-color: var(--color-explorar); }
        .report-item-card.explorar .report-item-icon { color: var(--color-explorar); }

        /* Estilos para navega√ß√£o lateral */
        .nav-item {
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .light .nav-item {
            background-color: transparent;
            color: var(--light-text-secondary);
        }
        .dark .nav-item {
            background-color: transparent;
            color: var(--dark-text-secondary);
        }
        .light .nav-item:hover {
            background-color: var(--light-card-bg);
            border-color: var(--light-border);
            color: var(--light-text-primary);
        }
        .dark .nav-item:hover {
            background-color: var(--dark-card-bg);
            border-color: var(--dark-border);
            color: var(--dark-text-primary);
        }
        .nav-item.active {
            background-image: linear-gradient(120deg, var(--accent-gradient-start) 0%, var(--accent-gradient-end) 100%);
            color: white !important;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
            transform: translateX(4px);
        }
        
        /* Estilos para bot√µes de setor */
        .sector-btn {
            padding: 1rem;
            border-radius: 0.75rem;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            font-weight: 500;
        }
        .light .sector-btn {
            background-color: var(--light-card-bg);
            color: var(--light-text-primary);
            border-color: var(--light-border);
        }
        .dark .sector-btn {
            background-color: var(--dark-card-bg);
            color: var(--dark-text-primary);
            border-color: var(--dark-border);
        }
        .sector-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .sector-btn.selected {
            background-image: linear-gradient(120deg, var(--accent-gradient-start) 0%, var(--accent-gradient-end) 100%);
            color: white;
            border-color: var(--accent-gradient-start);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
        }
        
        /* Estilos para bot√µes de IA */
        .ai-assist-btn, .sentiment-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .ai-assist-btn {
            background: linear-gradient(120deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);
        }
        .ai-assist-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        .sentiment-btn {
            background: linear-gradient(120deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 2px 10px rgba(245, 158, 11, 0.3);
        }
        .sentiment-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        
        /* Estilos para etapas do formul√°rio */
        .form-step {
            display: none; /* Controlado por JS e .active */
            animation: fadeInStep 0.5s ease-out;
        }
        .form-step.active {
            display: block;
        }
        
        @keyframes animatedGradientBG { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }
        @keyframes animatedTextGradient { 0% { background-position: 0% center; } 100% { background-position: 200% center; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInStep { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="light min-h-screen">
    <div class="fixed top-4 right-4 z-50">
        <button id="theme-toggle" class="p-3 rounded-full glass-container transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-purple-500">
            <svg id="sun-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg id="moon-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
        </button>
    </div>

    <div id="welcome-screen" class="welcome-screen-bg min-h-screen flex items-center justify-center p-4">
        <div class="glass-container p-8 md:p-12 max-w-2xl w-full text-center">
            <div class="mb-8">
                <div class="w-24 h-24 mx-auto mb-6 rounded-full border-4 border-purple-500 flex items-center justify-center">
                    <svg class="w-12 h-12 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
            </div>

            <h1 class="text-4xl md:text-5xl mb-6 animated-title-h1">Desvende o Futuro do Seu Neg√≥cio com IA</h1>
            
            <p class="text-lg md:text-xl mb-12 opacity-80">Responda com aten√ß√£o e insights. Sua jornada para a m√°xima efici√™ncia come√ßa agora.</p>
            
            <button id="start-diagnostic" class="button-primary px-8 py-4 rounded-lg font-semibold text-lg mb-8 transition-all duration-300">
                Iniciar Diagn√≥stico Avan√ßado
            </button>
        </div>
    </div>

    <div id="diagnostic-form" class="min-h-screen p-4 md:p-6 hidden">
        <div class="max-w-6xl mx-auto">
            <div class="glass-container p-6 mb-6 text-center">
                <h2 class="text-3xl font-bold mb-4 animated-title-header">Diagn√≥stico Empresarial Inteligente</h2>
                <p class="text-lg opacity-80">Preencha as informa√ß√µes abaixo para uma an√°lise personalizada</p>
                
                <div class="mt-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium">Progresso</span>
                        <span id="progress-text" class="text-sm font-medium">1 de 7</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                        <div id="progress-bar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2.5 rounded-full transition-all duration-300" style="width: 14.3%"></div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-6">
                <div class="lg:w-1/4">
                    <div class="glass-container p-4 sticky top-6">
                        <h3 class="font-semibold mb-4 text-lg">Se√ß√µes do Diagn√≥stico</h3>
                        <nav class="space-y-2">
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors active" data-step="1">
                                <span class="text-lg mr-2">üìä</span> Geral
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="2">
                                <span class="text-lg mr-2">‚öôÔ∏è</span> Processos
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="3">
                                <span class="text-lg mr-2">üìà</span> Marketing
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="4">
                                <span class="text-lg mr-2">üí∞</span> Financeiro
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="5">
                                <span class="text-lg mr-2">üë•</span> RH
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="6">
                                <span class="text-lg mr-2">üîß</span> Tecnologia
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="7">
                                <span class="text-lg mr-2">üéØ</span> Objetivos
                            </button>
                        </nav>
                    </div>
                </div>

                <div class="lg:w-3/4">
                    <form id="business-form" class="space-y-6">
                        <div class="form-step active" data-step="1">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center">
                                    <span class="text-2xl mr-3">üìä</span>
                                    1. Informa√ß√µes Gerais da Empresa
                                </h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="user_name" class="block text-sm font-medium mb-2">Seu Nome *</label>
                                        <input type="text" id="user_name" name="user_name" required placeholder="Digite seu nome completo" class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                    </div>
                                    <div>
                                        <label for="user_whatsapp" class="block text-sm font-medium mb-2">WhatsApp (com DDD) *</label>
                                        <input type="tel" id="user_whatsapp" name="user_whatsapp" required placeholder="Ex: 11999999999" class="w-full px-4 py-3 rounded-lg border focus:outline-none" pattern="[0-9]{10,11}">
                                        <p class="text-xs text-gray-500 mt-1">Apenas n√∫meros, sem espa√ßos ou s√≠mbolos. Ser√° usado para enviar o relat√≥rio.</p>
                                    </div>
                                    <div>
                                        <label for="company_name" class="block text-sm font-medium mb-2">Nome da Empresa *</label>
                                        <input type="text" id="company_name" name="company_name" required placeholder="Digite o nome da sua empresa" class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="company_name">
                                            ‚ú® Sugest√£o com IA
                                        </button>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Setor de Atua√ß√£o *</label>
                                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                            <button type="button" class="sector-btn" data-value="tecnologia"><span class="text-2xl mb-2 block">üíª</span>Tecnologia</button>
                                            <button type="button" class="sector-btn" data-value="varejo"><span class="text-2xl mb-2 block">üõçÔ∏è</span>Varejo</button>
                                            <button type="button" class="sector-btn" data-value="saude"><span class="text-2xl mb-2 block">‚ù§Ô∏è</span>Sa√∫de</button>
                                            <button type="button" class="sector-btn" data-value="financas"><span class="text-2xl mb-2 block">üíº</span>Finan√ßas</button>
                                            <button type="button" class="sector-btn" data-value="educacao"><span class="text-2xl mb-2 block">üéì</span>Educa√ß√£o</button>
                                            <button type="button" class="sector-btn" data-value="outro"><span class="text-2xl mb-2 block">‚û°Ô∏è</span>Outro</button>
                                        </div>
                                        <input type="hidden" id="sector" name="sector" required>
                                    </div>
                                    <div>
                                        <label for="company_size" class="block text-sm font-medium mb-2">Porte da Empresa (n¬∫ de funcion√°rios) *</label>
                                        <input type="text" id="company_size" name="company_size" required placeholder="Ex: 1-9, 10-49, 50-249, 250+" class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="company_size">
                                            ‚ú® Analisar com IA
                                        </button>
                                    </div>
                                    <div>
                                        <label for="main_products" class="block text-sm font-medium mb-2">Principais Produtos/Servi√ßos *</label>
                                        <textarea id="main_products" name="main_products" required rows="4" placeholder="Descreva os principais produtos ou servi√ßos oferecidos..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="main_products">
                                            ‚ú® Gerar ideias com IA
                                        </button>
                                    </div>
                                    <div>
                                        <label for="target_audience" class="block text-sm font-medium mb-2">P√∫blico-Alvo Principal *</label>
                                        <textarea id="target_audience" name="target_audience" required rows="3" placeholder="Descreva seu p√∫blico-alvo (idade, perfil, necessidades...)" class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="target_audience">
                                            ‚ú® Analisar com IA
                                        </button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="target_audience">
                                            üé≠ An√°lise de Sentimento
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="2">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">‚öôÔ∏è</span>2. Processos e Opera√ß√µes</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="internal_processes" class="block text-sm font-medium mb-2">Principais processos internos da empresa *</label>
                                        <textarea id="internal_processes" name="internal_processes" required rows="4" placeholder="Descreva os fluxos de trabalho mais importantes..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="internal_processes">‚ú® Otimizar com IA</button>
                                    </div>
                                    <div>
                                        <label for="tools_software" class="block text-sm font-medium mb-2">Ferramentas e softwares mais utilizados *</label>
                                        <textarea id="tools_software" name="tools_software" required rows="3" placeholder="Liste as principais ferramentas (CRM, ERP, comunica√ß√£o, etc.)..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="tools_software">‚ú® Sugerir melhorias com IA</button>
                                    </div>
                                    <div>
                                        <label for="operational_bottlenecks" class="block text-sm font-medium mb-2">Principais gargalos operacionais identificados *</label>
                                        <textarea id="operational_bottlenecks" name="operational_bottlenecks" required rows="4" placeholder="Quais s√£o os principais obst√°culos que impedem maior efici√™ncia?" class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="operational_bottlenecks">‚ú® Analisar solu√ß√µes com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="operational_bottlenecks">üé≠ An√°lise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="automation_opportunities" class="block text-sm font-medium mb-2">Tarefas repetitivas com potencial de automa√ß√£o *</label>
                                        <textarea id="automation_opportunities" name="automation_opportunities" required rows="3" placeholder="Identifique tarefas manuais e repetitivas que poderiam ser automatizadas..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="automation_opportunities">‚ú® Sugerir automa√ß√µes com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="3">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">üìà</span>3. Marketing e Vendas</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="marketing_channels" class="block text-sm font-medium mb-2">Canais de marketing e vendas utilizados *</label>
                                        <textarea id="marketing_channels" name="marketing_channels" required rows="3" placeholder="Redes sociais, site, email marketing, vendas diretas, parcerias..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="marketing_channels">‚ú® Otimizar canais com IA</button>
                                    </div>
                                    <div>
                                        <label for="marketing_strategies" class="block text-sm font-medium mb-2">Principais estrat√©gias de marketing e vendas *</label>
                                        <textarea id="marketing_strategies" name="marketing_strategies" required rows="4" placeholder="Descreva suas estrat√©gias atuais (Inbound, Outbound, Conte√∫do, etc.)..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="marketing_strategies">‚ú® Melhorar estrat√©gias com IA</button>
                                    </div>
                                    <div>
                                        <label for="marketing_performance" class="block text-sm font-medium mb-2">Performance atual de marketing e vendas *</label>
                                        <textarea id="marketing_performance" name="marketing_performance" required rows="3" placeholder="Como est√° o desempenho? M√©tricas, resultados, desafios..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="marketing_performance">‚ú® Analisar performance com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="marketing_performance">üé≠ An√°lise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="crm_usage" class="block text-sm font-medium mb-2">Utiliza alguma ferramenta de CRM? Qual? *</label>
                                        <input type="text" id="crm_usage" name="crm_usage" required placeholder="Ex: HubSpot, Salesforce, Pipedrive, RD Station, n√£o utiliza..." class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="crm_usage">‚ú® Sugerir CRM com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="4">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">üí∞</span>4. Gest√£o Financeira</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="main_expenses" class="block text-sm font-medium mb-2">Principais despesas e custos da empresa *</label>
                                        <textarea id="main_expenses" name="main_expenses" required rows="4" placeholder="Folha de pagamento, aluguel, marketing, tecnologia, fornecedores..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="main_expenses">‚ú® Otimizar custos com IA</button>
                                    </div>
                                    <div>
                                        <label for="revenue_sources" class="block text-sm font-medium mb-2">Principais fontes de receita *</label>
                                        <textarea id="revenue_sources" name="revenue_sources" required rows="3" placeholder="Vendas de produtos, servi√ßos, assinaturas, parcerias, etc..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="revenue_sources">‚ú® Diversificar receitas com IA</button>
                                    </div>
                                    <div>
                                        <label for="financial_challenges" class="block text-sm font-medium mb-2">Maiores desafios financeiros atuais *</label>
                                        <textarea id="financial_challenges" name="financial_challenges" required rows="4" placeholder="Fluxo de caixa, inadimpl√™ncia, custos altos, lucratividade..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="financial_challenges">‚ú® Resolver desafios com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="financial_challenges">üé≠ An√°lise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="financial_tools" class="block text-sm font-medium mb-2">Ferramentas de gest√£o financeira utilizadas *</label>
                                        <input type="text" id="financial_tools" name="financial_tools" required placeholder="Ex: Excel, QuickBooks, Conta Azul, sistema pr√≥prio..." class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="financial_tools">‚ú® Sugerir ferramentas com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="5">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">üë•</span>5. Recursos Humanos e Equipa</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="total_employees" class="block text-sm font-medium mb-2">N√∫mero total de colaboradores *</label>
                                        <input type="number" id="total_employees" name="total_employees" required placeholder="Ex: 25" class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="total_employees">‚ú® Analisar estrutura com IA</button>
                                    </div>
                                    <div>
                                        <label for="hr_challenges" class="block text-sm font-medium mb-2">Principais desafios na gest√£o de pessoas *</label>
                                        <textarea id="hr_challenges" name="hr_challenges" required rows="4" placeholder="Reten√ß√£o de talentos, motiva√ß√£o, comunica√ß√£o, treinamento, recrutamento..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="hr_challenges">‚ú® Resolver desafios de RH com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="hr_challenges">üé≠ An√°lise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="hr_software" class="block text-sm font-medium mb-2">Plataforma ou software para gest√£o de RH *</label>
                                        <input type="text" id="hr_software" name="hr_software" required placeholder="Ex: Gupy, S√≥lides, Factorial, sistema pr√≥prio, planilhas..." class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="hr_software">‚ú® Sugerir solu√ß√µes de RH com IA</button>
                                    </div>
                                    <div>
                                        <label for="performance_evaluation" class="block text-sm font-medium mb-2">Como √© feita a avalia√ß√£o de desempenho dos colaboradores? *</label>
                                        <textarea id="performance_evaluation" name="performance_evaluation" required rows="3" placeholder="Processo atual de avalia√ß√£o, frequ√™ncia, crit√©rios..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="performance_evaluation">‚ú® Melhorar avalia√ß√µes com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="6">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">üîß</span>6. Tecnologia e Inova√ß√£o</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="digitalization_level" class="block text-sm font-medium mb-2">N√≠vel de digitaliza√ß√£o atual da empresa *</label>
                                        <select id="digitalization_level" name="digitalization_level" required class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                            <option value="">Selecione o n√≠vel</option>
                                            <option value="basico">B√°sico (uso de email, planilhas b√°sicas)</option>
                                            <option value="intermediario">Intermedi√°rio (alguns sistemas espec√≠ficos, processos parcialmente digitais)</option>
                                            <option value="avancado">Avan√ßado (maioria dos processos digitalizados, uso de sistemas integrados)</option>
                                            <option value="muito_avancado">Muito Avan√ßado (totalmente digital, cultura data-driven, automa√ß√£o extensiva)</option>
                                        </select>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="digitalization_level">‚ú® Plano de digitaliza√ß√£o com IA</button>
                                    </div>
                                    <div>
                                        <label for="ai_usage" class="block text-sm font-medium mb-2">A empresa j√° utiliza ou explorou Intelig√™ncia Artificial? Como? *</label>
                                        <textarea id="ai_usage" name="ai_usage" required rows="3" placeholder="Chatbots, automa√ß√£o, an√°lise de dados, personaliza√ß√£o, ou 'Ainda n√£o utiliza'..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="ai_usage">‚ú® Oportunidades de IA</button>
                                    </div>
                                    <div>
                                        <label for="tech_challenges" class="block text-sm font-medium mb-2">Principais desafios tecnol√≥gicos enfrentados *</label>
                                        <textarea id="tech_challenges" name="tech_challenges" required rows="4" placeholder="Sistemas legados, seguran√ßa de dados, integra√ß√£o de ferramentas, falta de conhecimento t√©cnico..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="tech_challenges">‚ú® Resolver desafios tech com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="tech_challenges">üé≠ An√°lise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="tech_budget" class="block text-sm font-medium mb-2">Or√ßamento anual aproximado para tecnologia e inova√ß√£o *</label>
                                        <select id="tech_budget" name="tech_budget" required class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                            <option value="">Selecione a faixa de or√ßamento</option>
                                            <option value="ate_10k">At√© R$ 10.000</option>
                                            <option value="10k_50k">R$ 10.001 - R$ 50.000</option>
                                            <option value="50k_100k">R$ 50.001 - R$ 100.000</option>
                                            <option value="100k_500k">R$ 100.001 - R$ 500.000</option>
                                            <option value="acima_500k">Acima de R$ 500.000</option>
                                            <option value="nao_definido">N√£o definido / Varia muito</option>
                                        </select>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="tech_budget">‚ú® Otimizar investimento com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="7">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">üéØ</span>7. Desafios Gerais e Objetivos Futuros</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="top_challenges" class="block text-sm font-medium mb-2">Liste os 3 a 5 maiores desafios atuais da empresa (geral) *</label>
                                        <textarea id="top_challenges" name="top_challenges" required rows="5" placeholder="Concorr√™ncia, mudan√ßas no mercado, gest√£o interna, capta√ß√£o de clientes, etc..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="top_challenges">‚ú® Analisar desafios com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="top_challenges">üé≠ An√°lise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="business_objectives" class="block text-sm font-medium mb-2">Principais objetivos de neg√≥cio para os pr√≥ximos 6-12 meses *</label>
                                        <textarea id="business_objectives" name="business_objectives" required rows="4" placeholder="Aumentar faturamento em X%, lan√ßar novo produto, expandir para nova regi√£o, melhorar satisfa√ß√£o do cliente..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="business_objectives">‚ú® Estrat√©gias para objetivos com IA</button>
                                    </div>
                                    <div>
                                        <label for="consultancy_expectations" class="block text-sm font-medium mb-2">O que espera obter desta consultoria de diagn√≥stico? *</label>
                                        <textarea id="consultancy_expectations" name="consultancy_expectations" required rows="4" placeholder="Clareza sobre pontos de melhoria, um plano de a√ß√£o, novas ideias, solu√ß√µes para problemas espec√≠ficos..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="consultancy_expectations">‚ú® Personalizar consultoria com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="consultancy_expectations">üé≠ An√°lise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="growth_target" class="block text-sm font-medium mb-2">Meta de crescimento esperada para o pr√≥ximo ano *</label>
                                        <select id="growth_target" name="growth_target" required class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                            <option value="">Selecione a meta de crescimento</option>
                                            <option value="manutencao">Manter posi√ß√£o atual / Estabilidade</option>
                                            <option value="crescimento_moderado">Crescimento moderado (at√© 10-20%)</option>
                                            <option value="crescimento_acelerado">Crescimento acelerado (20-50%)</option>
                                            <option value="expansao_agressiva">Expans√£o agressiva (acima de 50%)</option>
                                        </select>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="growth_target">‚ú® Plano de crescimento com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row justify-between items-center pt-6 gap-4">
                            <button type="button" id="prev-step" class="button-secondary w-full sm:w-auto px-6 py-3 rounded-lg font-semibold" disabled>
                                ‚Üê Anterior
                            </button>
                            <button type="button" id="back-to-start" class="button-secondary w-full sm:w-auto px-6 py-3 rounded-lg font-semibold">
                                üè† In√≠cio
                            </button>
                            <button type="button" id="next-step" class="button-primary w-full sm:w-auto px-6 py-3 rounded-lg font-semibold">
                                Pr√≥ximo ‚Üí
                            </button>
                            <button type="submit" id="submit-form" class="button-success w-full sm:w-auto px-8 py-3 rounded-lg font-semibold hidden">
                                üöÄ Gerar Diagn√≥stico Completo
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="ai-chat-widget-container" class="fixed bottom-6 right-6 z-[1000]">
        <button id="ai-chat-toggle" class="w-14 h-14 bg-gradient-to-r from-purple-500 to-blue-600 rounded-full shadow-lg flex items-center justify-center text-white hover:scale-110 transition-transform focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
            <span class="text-2xl">ü§ñ</span>
        </button>
        <div id="ai-chat-panel" class="absolute bottom-20 right-0 w-80 sm:w-96 bg-white dark:bg-gray-800 rounded-lg shadow-xl border dark:border-gray-700 hidden flex flex-col" style="max-height: 70vh;">
            <div class="p-4 border-b dark:border-gray-700 bg-gradient-to-r from-purple-500 to-blue-600 text-white rounded-t-lg">
                <h3 class="font-semibold">Assistente IA PRO</h3>
                <p class="text-sm opacity-90">Como posso ajudar?</p>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-3">
                <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg max-w-[85%] mr-auto">
                    <p class="text-sm text-gray-800 dark:text-gray-200">Ol√°! Sou o seu assistente PRO. Se tiver d√∫vidas sobre algum campo ou precisar de ajuda, √© s√≥ perguntar!</p>
                </div>
            </div>
            <div class="p-4 border-t dark:border-gray-700">
                <div class="flex space-x-2">
                    <input type="text" id="chat-input" placeholder="Sua d√∫vida aqui..." class="flex-1 px-3 py-2 border dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <button id="send-chat" class="px-4 py-2 bg-purple-500 text-white rounded-lg text-sm hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                        Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm z-[1001] hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[85vh] overflow-hidden flex flex-col">
            <div class="p-5 border-b dark:border-gray-700 bg-gradient-to-r from-blue-500 to-purple-600 text-white">
                <div class="flex justify-between items-center">
                    <h3 id="ai-modal-title" class="text-xl font-semibold">Assistente IA PRO</h3>
                    <button id="close-ai-modal" class="text-white hover:text-gray-200 text-2xl leading-none">&times;</button>
                </div>
                <p class="text-sm opacity-90 mt-1" id="ai-modal-subtitle">Analisando o seu campo...</p>
            </div>
            <div class="p-6 flex-grow overflow-y-auto">
                <div id="ai-response" class="space-y-4 text-gray-800 dark:text-gray-200">
                    <div class="flex items-center space-x-2 text-gray-500 dark:text-gray-400">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"></div>
                        <span>A processar com IA...</span>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
                <div class="flex justify-end space-x-3">
                    <button id="apply-ai-suggestion" class="button-success px-4 py-2 rounded-lg text-sm hidden">
                        ‚úÖ Aplicar Sugest√£o
                    </button>
                    <button id="close-ai-modal-btn" class="button-secondary px-4 py-2 rounded-lg text-sm">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="report-screen" class="min-h-screen p-4 md:p-6 hidden">
        <div class="max-w-6xl mx-auto">
            <div class="glass-container p-8 mb-6 text-center">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 flex items-center justify-center">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl md:text-4xl font-bold mb-4 animated-title-h1">Diagn√≥stico Empresarial Completo</h1>
                <p id="company-title-report" class="text-xl opacity-80 mb-2"></p>
                <p class="text-sm opacity-60">Relat√≥rio gerado em <span id="report-date"></span></p>
            </div>

            <div class="glass-container p-6 mb-6">
                <h2 class="text-2xl font-bold mb-4 flex items-center"><span class="text-2xl mr-3">üìã</span>Resumo Executivo</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="text-center p-4 rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30">
                        <div class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="score-overall">0%</div>
                        <div class="text-sm font-medium mt-1">Pontua√ß√£o Geral de Prontid√£o</div>
                    </div>
                    <div class="text-center p-4 rounded-lg bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30">
                        <div class="text-3xl font-bold text-green-600 dark:text-green-400" id="opportunities-count">0</div>
                        <div class="text-sm font-medium mt-1">Recomenda√ß√µes Chave</div>
                    </div>
                    <div class="text-center p-4 rounded-lg bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/30 dark:to-orange-800/30">
                        <div class="text-3xl font-bold text-orange-600 dark:text-orange-400" id="priorities-count">0</div>
                        <div class="text-sm font-medium mt-1">√Åreas de Melhoria Priorit√°rias</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="glass-container p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center"><span class="text-xl mr-3">üí™</span>Pontos Fortes Identificados</h3>
                    <div id="strengths-list" class="space-y-3"></div>
                </div>
                <div class="glass-container p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center"><span class="text-xl mr-3">üéØ</span>√Åreas de Melhoria Priorit√°rias</h3>
                    <div id="improvements-list" class="space-y-3"></div>
                </div>
            </div>

            <div class="glass-container p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 flex items-center"><span class="text-xl mr-3">üöÄ</span>Recomenda√ß√µes Estrat√©gicas com IA</h3>
                <div id="recommendations-list" class="space-y-4"></div>
            </div>

            <div class="glass-container p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 flex items-center"><span class="text-xl mr-3">üìÖ</span>Plano de A√ß√£o Sugerido (Pr√≥ximos 90 Dias)</h3>
                <div id="action-plan" class="space-y-4"></div>
            </div>

            <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                <button id="download-report" class="button-primary px-6 py-3 rounded-lg font-semibold w-full sm:w-auto">
                    üìÑ Baixar Relat√≥rio PDF
                </button>
                <button id="new-analysis" class="button-secondary px-6 py-3 rounded-lg font-semibold w-full sm:w-auto">
                    üîÑ Nova An√°lise
                </button>
                <button id="share-report" class="button-success px-6 py-3 rounded-lg font-semibold w-full sm:w-auto">
                    üì§ Partilhar Resultados
                </button>
            </div>
        </div>
    </div>

<script>
    // Vari√°veis globais
    let currentStep = 1;
    const totalSteps = 7; // N√∫mero total de etapas no formul√°rio
    
    // Elementos da UI
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');

    const businessFormEl = document.getElementById('business-form'); // Renomeado para evitar conflito com a vari√°vel global 'businessForm'
    const welcomeScreen = document.getElementById('welcome-screen');
    const diagnosticForm = document.getElementById('diagnostic-form');
    const reportScreen = document.getElementById('report-screen');
    
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');

    const prevStepBtn = document.getElementById('prev-step');
    const nextStepBtn = document.getElementById('next-step');
    const submitFormBtn = document.getElementById('submit-form');
    const backToStartBtn = document.getElementById('back-to-start');
    
    // --- Inicializa√ß√£o e Manipuladores de Eventos Principais ---
    document.addEventListener('DOMContentLoaded', () => {
        // Prefer√™ncia de tema do sistema
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            enableDarkMode();
        } else {
            enableLightMode();
        }

        // Configurar ouvintes de eventos
        if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
        
        const startDiagnosticBtn = document.getElementById('start-diagnostic');
        if (startDiagnosticBtn) startDiagnosticBtn.addEventListener('click', handleStartDiagnostic);
        if (backToStartBtn) backToStartBtn.addEventListener('click', handleBackToStart);

        document.querySelectorAll('.nav-item').forEach(item => item.addEventListener('click', handleNavClick));
        document.querySelectorAll('.sector-btn').forEach(btn => btn.addEventListener('click', handleSectorSelect));
        document.querySelectorAll('.ai-assist-btn').forEach(btn => btn.addEventListener('click', handleAIAssistClick));
        document.querySelectorAll('.sentiment-btn').forEach(btn => btn.addEventListener('click', handleSentimentAnalysisClick));

        if (prevStepBtn) prevStepBtn.addEventListener('click', handlePrevStep);
        if (nextStepBtn) nextStepBtn.addEventListener('click', handleNextStep);
        if (businessFormEl) businessFormEl.addEventListener('submit', handleFormSubmit);
        
        // Bot√µes do relat√≥rio
        const newAnalysisBtn = document.getElementById('new-analysis');
        if (newAnalysisBtn) newAnalysisBtn.addEventListener('click', handleNewAnalysis);
        const downloadReportBtn = document.getElementById('download-report');
        if (downloadReportBtn) downloadReportBtn.addEventListener('click', () => showTemporaryMessage('Funcionalidade de download do relat√≥rio em PDF ser√° implementada em breve!'));
        const shareReportBtn = document.getElementById('share-report');
        if (shareReportBtn) shareReportBtn.addEventListener('click', handleShareReport);

        // Inicializar o estado do formul√°rio (se j√° estiver vis√≠vel, por exemplo, ao recarregar a p√°gina)
        if (diagnosticForm && !diagnosticForm.classList.contains('hidden')) {
            showStep(currentStep); // Garante que a etapa correta seja exibida
        } else {
            updateNavigationButtons(); // Garante que os bot√µes de navega√ß√£o estejam no estado correto para a tela de boas-vindas
        }
        
        // Anima√ß√µes de entrada
        setupIntersectionObserver();
        // Chat IA
        setupAIChat();
        // Modal IA
        setupAIModal();
    });

    // --- Fun√ß√µes de Tema ---
    function toggleTheme() {
        if (body.classList.contains('dark')) {
            enableLightMode();
            localStorage.setItem('theme', 'light');
        } else {
            enableDarkMode();
            localStorage.setItem('theme', 'dark');
        }
    }
    function enableDarkMode() {
        body.classList.remove('light');
        body.classList.add('dark');
        if(sunIcon) sunIcon.classList.add('hidden');
        if(moonIcon) moonIcon.classList.remove('hidden');
    }
    function enableLightMode() {
        body.classList.remove('dark');
        body.classList.add('light');
        if(sunIcon) sunIcon.classList.remove('hidden');
        if(moonIcon) moonIcon.classList.add('hidden');
    }

    // --- Navega√ß√£o e Estado do Formul√°rio ---
    function handleStartDiagnostic() {
        if (welcomeScreen) welcomeScreen.classList.add('hidden');
        if (diagnosticForm) diagnosticForm.classList.remove('hidden');
        currentStep = 1;
        showStep(currentStep);
    }

    function handleBackToStart() {
        if (diagnosticForm) diagnosticForm.classList.add('hidden');
        if (welcomeScreen) welcomeScreen.classList.remove('hidden');
        // Opcional: resetar o formul√°rio se desejar
        // if (businessFormEl) businessFormEl.reset();
        // currentStep = 1;
        // updateProgressBar();
        // updateNavigationButtons();
    }

    function showStep(stepNumber) {
        document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
        const targetStep = document.querySelector(`.form-step[data-step="${stepNumber}"]`);
        if (targetStep) targetStep.classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (parseInt(item.dataset.step) === stepNumber) item.classList.add('active');
        });
        
        currentStep = stepNumber;
        updateProgressBar();
        updateNavigationButtons();
        window.scrollTo(0, 0); // Scroll para o topo ao mudar de etapa
    }

    function updateProgressBar() {
        if (progressBar && progressText) {
            const percentage = Math.max(0, (currentStep -1) / (totalSteps -1)) * 100; // Corre√ß√£o para progresso de 0 a 100
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `Etapa ${currentStep} de ${totalSteps}`;
        }
    }

    function updateNavigationButtons() {
        if (!prevStepBtn || !nextStepBtn || !submitFormBtn) return;

        prevStepBtn.disabled = currentStep === 1;
        prevStepBtn.style.opacity = prevStepBtn.disabled ? '0.5' : '1';
        
        if (currentStep === totalSteps) {
            nextStepBtn.classList.add('hidden');
            submitFormBtn.classList.remove('hidden');
        } else {
            nextStepBtn.classList.remove('hidden');
            submitFormBtn.classList.add('hidden');
        }
    }

    function handleNavClick(event) {
        const stepNumber = parseInt(event.currentTarget.dataset.step);
        // Permite navega√ß√£o para etapas anteriores ou para a pr√≥xima se a atual for v√°lida
        if (stepNumber < currentStep || validateCurrentStep()) {
            showStep(stepNumber);
        }
    }
    
    function handlePrevStep() {
        if (currentStep > 1) showStep(currentStep - 1);
    }

    function handleNextStep() {
        if (validateCurrentStep() && currentStep < totalSteps) {
            showStep(currentStep + 1);
        }
    }

    function handleSectorSelect(event) {
        document.querySelectorAll('.sector-btn').forEach(b => b.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        const sectorInput = document.querySelector('input[name="sector"]');
        if (sectorInput) sectorInput.value = event.currentTarget.dataset.value;
    }

    // --- Valida√ß√£o do Formul√°rio ---
    function validateCurrentStep() {
        const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"]`);
        if (!currentStepElement) return false;

        let isValid = true;
        const requiredFields = currentStepElement.querySelectorAll('[required]');
        let firstInvalidField = null;
        
        requiredFields.forEach(field => {
            field.classList.remove('border-red-500', 'ring-1', 'ring-red-500'); // Limpar erros anteriores
            let fieldIsValid = true;

            if (field.type === 'hidden' && field.name === 'sector') { // Valida√ß√£o espec√≠fica para bot√µes de setor
                if (!field.value.trim()) fieldIsValid = false;
            } else if (field.type === 'checkbox') {
                if (!field.checked) fieldIsValid = false;
            } else if (field.type === 'radio') {
                const radioGroup = document.querySelector(`input[name="${field.name}"]:checked`);
                if (!radioGroup) fieldIsValid = false;
            } else if (!field.value || field.value.trim() === '') {
                fieldIsValid = false;
            }

            if (!fieldIsValid) {
                isValid = false;
                field.classList.add('border-red-500', 'ring-1', 'ring-red-500');
                if (!firstInvalidField) firstInvalidField = field;
            }
        });

        if (!isValid && firstInvalidField) {
            firstInvalidField.focus({ preventScroll: true }); // Foca sem scroll brusco
            // Scroll suave para o campo inv√°lido
            firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
            showTemporaryMessage('Por favor, preencha todos os campos obrigat√≥rios (*) antes de continuar.', 'error', 5000);
        }
        return isValid;
    }
    
    // --- Submiss√£o do Formul√°rio e Gera√ß√£o de Relat√≥rio ---
    function handleFormSubmit(event) {
        event.preventDefault();
        if (!validateCurrentStep()) return;

        const formData = new FormData(businessFormEl);
        const diagnosticData = Object.fromEntries(formData.entries());

        if (submitFormBtn) {
            const originalText = submitFormBtn.textContent;
            submitFormBtn.innerHTML = `<span class="animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white inline-block mr-2"></span> Processando...`;
            submitFormBtn.disabled = true;

            setTimeout(async () => { // Simula√ß√£o de processamento
                generateReport(diagnosticData);
                showReportScreenUI();
                
                // Enviar dados para o webhook do n8n
                await sendToWebhook(diagnosticData);
                
                submitFormBtn.innerHTML = originalText; // Restaurar texto original
                submitFormBtn.disabled = false;
            }, 2500);
        }
    }

    function generateReport(data) {
        const companyTitleEl = document.getElementById('company-title-report');
        const reportDateEl = document.getElementById('report-date');
        if (companyTitleEl) companyTitleEl.textContent = `Relat√≥rio para ${data.company_name || 'a sua Empresa'}`;
        if (reportDateEl) reportDateEl.textContent = new Date().toLocaleDateString('pt-BR', { year: 'numeric', month: 'long', day: 'numeric' });
        
        const score = calculateOverallScore(data); // Renomeado para clareza
        const scoreOverallEl = document.getElementById('score-overall');
        if (scoreOverallEl) scoreOverallEl.textContent = `${score}%`;

        const strengths = generateStrengthsList(data); // Renomeado para clareza
        populateReportListUI('strengths-list', strengths, 'bg-green-50 dark:bg-green-900/30', 'bg-green-500');
        
        const improvements = generateImprovementsList(data); // Renomeado para clareza
        populateReportListUI('improvements-list', improvements, 'bg-orange-50 dark:bg-orange-900/30', 'bg-orange-500');
        const prioritiesCountEl = document.getElementById('priorities-count');
        if (prioritiesCountEl) prioritiesCountEl.textContent = improvements.length;

        const recommendations = generateRecommendationsList(data); // Renomeado para clareza
        populateReportItemsUI('recommendations-list', recommendations, 'explorar');
        const opportunitiesCountEl = document.getElementById('opportunities-count');
        if (opportunitiesCountEl) opportunitiesCountEl.textContent = recommendations.length;

        const actionPlan = generateActionPlanItems(data); // Renomeado para clareza
        populateReportItemsUI('action-plan', actionPlan, 'solucao');
    }
    
    function showReportScreenUI() {
        if (diagnosticForm) diagnosticForm.classList.add('hidden');
        if (reportScreen) reportScreen.classList.remove('hidden');
        window.scrollTo(0,0);
    }

    // --- L√≥gica de Gera√ß√£o de Conte√∫do do Relat√≥rio (Exemplos) ---
    function calculateOverallScore(data) {
        let score = 50; // Pontua√ß√£o base
        if (data.sector && data.sector !== 'outro') score += 5;
        if (data.company_size && (data.company_size.toLowerCase().includes('media') || data.company_size.toLowerCase().includes('grande') || parseInt(data.company_size) > 49)) score += 5;
        if (data.digitalization_level === 'avancado' || data.digitalization_level === 'muito_avancado') score += 10;
        if (data.ai_usage && !data.ai_usage.toLowerCase().includes("n√£o utiliza") && data.ai_usage.length > 10) score += 8;
        if (data.growth_target === 'expansao_agressiva' || data.growth_target === 'crescimento_acelerado') score += 7;
        if (data.business_objectives && data.business_objectives.length > 50) score += 5;
        if (data.consultancy_expectations && data.consultancy_expectations.length > 30) score += 3;
        if (data.marketing_strategies && data.marketing_strategies.length > 30) score += 4;
        if (data.crm_usage && !data.crm_usage.toLowerCase().includes("n√£o utiliza")) score += 3;
        return Math.min(Math.max(score, 30), 98); // Score entre 30 e 98
    }

    function generateStrengthsList(data) {
        const strengths = [];
        if (data.company_name) strengths.push(`Empresa com identidade definida: <strong>${data.company_name}</strong>.`);
        if (data.sector && data.sector !== "outro") strengths.push(`Foco setorial claro em: <strong>${data.sector.charAt(0).toUpperCase() + data.sector.slice(1)}</strong>.`);
        if (data.main_products && data.main_products.length > 30) strengths.push("Portf√≥lio de produtos/servi√ßos bem descrito.");
        if (data.target_audience && data.target_audience.length > 30) strengths.push("Compreens√£o inicial do p√∫blico-alvo.");
        if (data.growth_target && data.growth_target !== "manutencao") strengths.push(`Ambi√ß√£o e vis√£o de crescimento (Meta: ${data.growth_target.replace(/_/g, ' ').toLowerCase()})`);
        if (data.consultancy_expectations && data.consultancy_expectations.length > 20) strengths.push("Proatividade em buscar consultoria e melhoria cont√≠nua.");
        if (strengths.length < 2) strengths.push("Iniciativa para realizar auto-diagn√≥stico e identificar √°reas de desenvolvimento.");
        return strengths;
    }

    function generateImprovementsList(data) {
        const improvements = [];
        if (!data.internal_processes || data.internal_processes.length < 50) improvements.push("Refinar o mapeamento e a otimiza√ß√£o de processos internos chave.");
        if (data.operational_bottlenecks && data.operational_bottlenecks.length > 15) improvements.push(`Abordar proativamente os gargalos operacionais como: "${data.operational_bottlenecks.substring(0,40)}...".`);
        if (data.automation_opportunities && data.automation_opportunities.length > 15) improvements.push(`Explorar e implementar oportunidades de automa√ß√£o identificadas em: "${data.automation_opportunities.substring(0,40)}...".`);
        if (!data.marketing_strategies || data.marketing_strategies.length < 50) improvements.push("Desenvolver ou aprimorar estrat√©gias de marketing e vendas mais robustas.");
        if (data.crm_usage && (data.crm_usage.toLowerCase().includes("n√£o utiliza") || data.crm_usage.toLowerCase().includes("excel") || data.crm_usage.toLowerCase().includes("planilhas"))) improvements.push("Considerar a implementa√ß√£o ou otimiza√ß√£o do uso de uma ferramenta de CRM dedicada.");
        if (data.financial_challenges && data.financial_challenges.length > 15) improvements.push("Desenvolver estrat√©gias para superar os desafios financeiros mencionados.");
        if (data.hr_challenges && data.hr_challenges.length > 15) improvements.push("Fortalecer as pr√°ticas de gest√£o de recursos humanos e abordar os desafios da equipa.");
        if (data.digitalization_level === "basico" || data.digitalization_level === "intermediario") improvements.push("Acelerar a transforma√ß√£o digital e a ado√ß√£o de novas tecnologias.");
        if (data.tech_challenges && data.tech_challenges.length > 15) improvements.push("Elaborar um plano para mitigar os desafios tecnol√≥gicos identificados.");
        if (improvements.length < 2) improvements.push("Identificar e priorizar √°reas chave para desenvolvimento estrat√©gico focado.");
        return improvements.slice(0, 5);
    }

    function generateRecommendationsList(data) {
        const recommendations = [];
        const icons = { perigo: '‚ö†Ô∏è', oportunidade: 'üí°', desafio: 'üéØ', solucao: '‚úÖ', explorar: 'üó∫Ô∏è' }; // √çcones para categorias

        if (data.digitalization_level === "basico") {
            recommendations.push({ icon: icons.oportunidade, title: "Plano de Digitaliza√ß√£o Priorit√°rio", description: "Iniciar um projeto focado na digitaliza√ß√£o de 2-3 processos chave (ex: atendimento, vendas) nos pr√≥ximos 90 dias. Avaliar ferramentas de baixo custo para iniciar." });
        }
        if (data.ai_usage && (data.ai_usage.toLowerCase().includes("n√£o utiliza") || data.ai_usage.toLowerCase().includes("ainda n√£o") || data.ai_usage.length < 20 )) {
            recommendations.push({ icon: icons.explorar, title: "Explora√ß√£o Estrat√©gica de IA", description: "Realizar um workshop interno para identificar 2-3 casos de uso de IA com potencial de ROI r√°pido (ex: chatbot para FAQ, an√°lise de sentimento de feedback de clientes)." });
        }
        if (data.operational_bottlenecks && data.operational_bottlenecks.length > 10) {
            recommendations.push({ icon: icons.desafio, title: "Task-Force para Otimiza√ß√£o de Processos", description: `Criar uma pequena equipa multifuncional para analisar e propor solu√ß√µes para os principais gargalos operacionais (ex: "${data.operational_bottlenecks.substring(0,30)}...") em 60 dias.` });
        }
        if (!data.marketing_performance || data.marketing_performance.length < 50) {
             recommendations.push({ icon: icons.oportunidade, title: "Defini√ß√£o e Monitoriza√ß√£o de KPIs de Marketing", description: "Estabelecer 3-5 KPIs cruciais para marketing e vendas (ex: taxa de convers√£o, CAC, LTV) e implementar um dashboard simples para acompanhamento semanal." });
        }
        if (data.financial_challenges && data.financial_challenges.length > 10) {
            recommendations.push({ icon: icons.perigo, title: "An√°lise Financeira Detalhada e Plano de A√ß√£o", description: `Contratar uma consultoria financeira breve ou dedicar tempo interno para uma an√°lise profunda dos desafios financeiros (ex: "${data.financial_challenges.substring(0,30)}...") e criar um plano de mitiga√ß√£o.` });
        }
        if (recommendations.length < 2 && data.top_challenges) {
            const firstChallenge = data.top_challenges.split(/[\n,;]/)[0].trim();
            recommendations.push({ icon: icons.desafio, title: "Foco no Principal Desafio Estrat√©gico", description: `Priorizar recursos e aten√ß√£o para desenvolver uma estrat√©gia clara para enfrentar o desafio principal identificado: "${firstChallenge.substring(0,50)}...".` });
        }
        if (recommendations.length === 0) {
            recommendations.push({ icon: icons.explorar, title: "Revis√£o Estrat√©gica e Defini√ß√£o de Prioridades", description: "Conduzir uma sess√£o de planeamento estrat√©gico para revisitar a vis√£o da empresa, analisar o mercado e definir 3 prioridades claras para os pr√≥ximos 6 meses."});
        }
        return recommendations.slice(0,4);
    }

    function generateActionPlanItems(data) {
        const actions = [];
        const icons = { perigo: '‚ö†Ô∏è', oportunidade: 'üí°', desafio: 'üéØ', solucao: '‚úÖ', explorar: 'üó∫Ô∏è', calendario: 'üóìÔ∏è' };

        actions.push({ icon: icons.calendario, title: "Reuni√£o de An√°lise do Diagn√≥stico e Defini√ß√£o de Pr√≥ximos Passos", description: "Agendar uma reuni√£o com as partes interessadas chave para discutir os resultados deste diagn√≥stico e definir responsabilidades para as a√ß√µes priorit√°rias.", timeline: "Pr√≥ximos 7 dias" });
        
        if (data.operational_bottlenecks || data.automation_opportunities) {
             actions.push({ icon: icons.solucao, title: "Workshop de Mapeamento e Otimiza√ß√£o de Processos (Piloto)", description: "Selecionar 1 processo cr√≠tico para um workshop de mapeamento detalhado, identificando pontos de melhoria e potencial de automa√ß√£o. Definir um plano piloto.", timeline: "Pr√≥ximas 3 semanas" });
        }
        if (!data.marketing_strategies || data.marketing_strategies.length < 50) {
             actions.push({ icon: icons.oportunidade, title: "Sprint de Planeamento de Marketing e Vendas", description: "Realizar um sprint de 1 semana para definir/refinar 2-3 iniciativas de marketing/vendas de alto impacto para os pr√≥ximos 60 dias, com metas claras e mensur√°veis.", timeline: "Pr√≥ximas 4 semanas" });
        }
        if (data.digitalization_level === "basico" && (!data.tools_software || data.tools_software.length < 30)) {
            actions.push({ icon: icons.explorar, title: "Pesquisa e Sele√ß√£o de Ferramenta Colaborativa/Gest√£o", description: "Pesquisar e selecionar uma ferramenta b√°sica (muitas vezes gratuita ou de baixo custo) para melhorar a gest√£o de tarefas e a comunica√ß√£o da equipa. Implementar em 45 dias.", timeline: "Pr√≥ximos 45 dias" });
        }
        if (actions.length < 3 && data.business_objectives) {
             actions.push({ icon: icons.desafio, title: "Tradu√ß√£o de Objetivos em Metas SMART", description: "Desdobrar os principais objetivos de neg√≥cio em metas SMART (Espec√≠ficas, Mensur√°veis, Ating√≠veis, Relevantes, Temporais) para as equipas/√°reas respons√°veis.", timeline: "Pr√≥ximas 2 semanas"});
        }
        actions.push({ icon: icons.calendario, title: "Revis√£o de Progresso (Checkpoint 1)", description: "Agendar uma reuni√£o de acompanhamento em 45 dias para avaliar o progresso das a√ß√µes iniciais, identificar obst√°culos e fazer ajustes no plano.", timeline: "Em 45 dias" });
        return actions.slice(0,4);
    }
    
    // --- Fun√ß√µes Auxiliares de UI do Relat√≥rio ---
    function populateReportListUI(elementId, items, itemBgClass, dotColorClass) {
        const listElement = document.getElementById(elementId);
        if (!listElement) return;
        listElement.innerHTML = ''; // Limpar conte√∫do anterior
        if (items.length > 0) {
            const ul = document.createElement('ul');
            ul.className = 'space-y-2';
            items.forEach(itemText => {
                const li = document.createElement('li');
                li.className = `flex items-start space-x-3 p-3 rounded-md ${itemBgClass}`;
                li.innerHTML = `
                    <span class="flex-shrink-0 inline-block w-2 h-2 rounded-full ${dotColorClass}" style="margin-top: 0.4em;"></span>
                    <span class="text-sm">${itemText}</span>`; // innerHTML para permitir tags como <strong>
                ul.appendChild(li);
            });
            listElement.appendChild(ul);
        } else {
            listElement.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400 italic">Nenhum item espec√≠fico identificado nesta categoria com base nas respostas fornecidas.</p>`;
        }
    }

    function populateReportItemsUI(elementId, items, defaultCategoryClass) {
        const listElement = document.getElementById(elementId);
        if (!listElement) return;
        listElement.innerHTML = ''; // Limpar conte√∫do anterior
        if (items.length > 0) {
            items.forEach(item => {
                const div = document.createElement('div');
                // Usa a classe da categoria do item se existir, sen√£o usa a defaultCategoryClass
                div.className = `report-item-card ${item.categoryClass || defaultCategoryClass}`; 
                div.innerHTML = `
                    <div class="report-item-icon">${item.icon || '‚û°Ô∏è'}</div>
                    <div class="report-item-content">
                        <div class="report-item-title">${item.title} ${item.timeline ? `<span class="text-xs font-normal text-purple-600 dark:text-purple-400 ml-2">(${item.timeline})</span>` : ''}</div>
                        <div class="report-item-description">${item.description}</div>
                    </div>`;
                listElement.appendChild(div);
            });
        } else {
            listElement.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400 italic">Nenhuma informa√ß√£o espec√≠fica gerada para esta sec√ß√£o.</p>`;
        }
    }
    
    // --- Bot√µes do Relat√≥rio ---
    function handleNewAnalysis() {
        if (reportScreen) reportScreen.classList.add('hidden');
        if (businessFormEl) {
            businessFormEl.reset();
            // Limpar classes de erro dos campos
            businessFormEl.querySelectorAll('.border-red-500').forEach(el => el.classList.remove('border-red-500', 'ring-1', 'ring-red-500'));
        }
        document.querySelectorAll('.sector-btn.selected').forEach(btn => btn.classList.remove('selected'));
        document.querySelectorAll('.sentiment-result').forEach(el => el.remove());

        if (welcomeScreen) welcomeScreen.classList.remove('hidden');
        currentStep = 1;
        showStep(1); // Mostra a primeira etapa do formul√°rio
        window.scrollTo(0,0);
    }

    function handleShareReport() {
        const reportTitle = document.getElementById('company-title-report')?.textContent || "Diagn√≥stico Empresarial";
        const reportScore = document.getElementById('score-overall')?.textContent || "";
        const shareData = {
            title: `Resultado: ${reportTitle}`,
            text: `Conclu√≠ o Diagn√≥stico Empresarial Inteligente PRO! Pontua√ß√£o Geral: ${reportScore}. Confira as principais recomenda√ß√µes.`,
            url: window.location.href // Ou um link para uma vers√£o online/compartilh√°vel do relat√≥rio
        };
        if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
            navigator.share(shareData)
                .then(() => showTemporaryMessage('Relat√≥rio partilhado com sucesso!'))
                .catch(err => {
                    console.error('Erro ao partilhar:', err);
                    showTemporaryMessage('N√£o foi poss√≠vel partilhar automaticamente. Pode copiar o link.', 'error');
                });
        } else {
            // Fallback para copiar link ou mostrar mensagem
            try {
                navigator.clipboard.writeText(window.location.href);
                showTemporaryMessage('Link do relat√≥rio copiado para a √°rea de transfer√™ncia!');
            } catch (err) {
                showTemporaryMessage('Partilha n√£o suportada neste navegador. Tente copiar o link da p√°gina.', 'error');
            }
        }
    }

    // --- Funcionalidades de IA (Chat e Modal de Campo) ---
    let currentAIInteractionField = null; // Para o modal de IA de campo

    function setupAIChat() {
        const aiChatToggleBtn = document.getElementById('ai-chat-toggle');
        const aiChatPanel = document.getElementById('ai-chat-panel');
        const sendChatBtn = document.getElementById('send-chat');
        const chatInputEl = document.getElementById('chat-input');

        if (aiChatToggleBtn && aiChatPanel) {
            aiChatToggleBtn.addEventListener('click', () => aiChatPanel.classList.toggle('hidden'));
        }
        if (sendChatBtn && chatInputEl) {
            sendChatBtn.addEventListener('click', () => handleSendChatMessage(chatInputEl));
            chatInputEl.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSendChatMessage(chatInputEl); });
        }
    }
    
    function handleSendChatMessage(inputElement) {
        const message = inputElement.value.trim();
        if (message) {
            addMessageToChatUI(message, 'user');
            inputElement.value = '';
            // Simular resposta da IA
            setTimeout(() => {
                const response = getAIChatResponseForMessage(message); // Renomeado
                addMessageToChatUI(response, 'ai');
            }, 1200);
        }
    }

    function addMessageToChatUI(message, sender) {
        const chatMessagesDiv = document.getElementById('chat-messages');
        if (!chatMessagesDiv) return;

        const messageDiv = document.createElement('div');
        messageDiv.classList.add('p-3', 'rounded-lg', 'text-sm', 'max-w-[85%]', 'mb-2', 'break-words');
        if (sender === 'user') {
            messageDiv.classList.add('bg-purple-100', 'dark:bg-purple-700', 'ml-auto', 'text-right', 'text-gray-800', 'dark:text-gray-200');
            messageDiv.innerHTML = `<strong>Voc√™:</strong> ${message}`;
        } else {
            messageDiv.classList.add('bg-blue-100', 'dark:bg-blue-700', 'mr-auto', 'text-gray-800', 'dark:text-gray-200');
            messageDiv.innerHTML = `<strong>Assistente IA:</strong> ${message}`;
        }
        chatMessagesDiv.appendChild(messageDiv);
        chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Auto-scroll
    }

    function getAIChatResponseForMessage(message) {
        const originalMessage = message;
        message = message.toLowerCase();
        
        // Sauda√ß√µes
        if (message.includes("ol√°") || message.includes("oi") || message.includes("bom dia") || message.includes("boa tarde") || message.includes("boa noite")) {
            return "Ol√°! üëã Sou o seu assistente de diagn√≥stico empresarial. Como posso ajud√°-lo hoje? Posso esclarecer d√∫vidas sobre qualquer sec√ß√£o do formul√°rio ou dar sugest√µes espec√≠ficas para o seu neg√≥cio.";
        }
        
        // Perguntas sobre etapas espec√≠ficas
        if (message.includes("geral") || message.includes("empresa") || message.includes("nome") || message.includes("setor")) {
            return "üìä **Informa√ß√µes Gerais**: Esta sec√ß√£o √© fundamental! Dicas importantes:\n\n‚Ä¢ **Nome da empresa**: Use algo memor√°vel que reflita a sua marca\n‚Ä¢ **Setor**: Escolha o mais espec√≠fico poss√≠vel para an√°lises precisas\n‚Ä¢ **Tamanho**: Seja preciso no n√∫mero de funcion√°rios\n‚Ä¢ **Produtos/Servi√ßos**: Foque nos 2-3 principais que geram mais receita\n\nPrecisa de ajuda com algum campo espec√≠fico?";
        }
        
        if (message.includes("processo") || message.includes("fluxo") || message.includes("opera√ß√£o")) {
            return "‚öôÔ∏è **Processos Operacionais**: Aqui analisamos a efici√™ncia! Dicas:\n\n‚Ä¢ **Fluxos principais**: Mapeie desde o pedido at√© a entrega\n‚Ä¢ **Ferramentas**: Liste todos os softwares que usa diariamente\n‚Ä¢ **Gargalos**: Identifique onde o trabalho 'emperra'\n‚Ä¢ **Automa√ß√£o**: Pense em tarefas repetitivas que consome tempo\n\nQual processo espec√≠fico quer otimizar?";
        }
        
        if (message.includes("marketing") || message.includes("cliente") || message.includes("vendas") || message.includes("publicidade")) {
            return "üìà **Marketing e Vendas**: Vamos potenciar a sua presen√ßa! Estrat√©gias:\n\n‚Ä¢ **Canais digitais**: Redes sociais, site, email marketing\n‚Ä¢ **M√©tricas**: ROI, convers√£o, custo por lead\n‚Ä¢ **P√∫blico-alvo**: Defina personas espec√≠ficas\n‚Ä¢ **CRM**: Fundamental para acompanhar leads\n\nEm que canal quer focar mais?";
        }
        
        if (message.includes("financeiro") || message.includes("dinheiro") || message.includes("custo") || message.includes("receita") || message.includes("lucro")) {
            return "üí∞ **Gest√£o Financeira**: A base do sucesso! Pontos-chave:\n\n‚Ä¢ **Controlo de custos**: Identifique os maiores gastos\n‚Ä¢ **Diversifica√ß√£o**: M√∫ltiplas fontes de receita\n‚Ä¢ **Fluxo de caixa**: Previsibilidade √© essencial\n‚Ä¢ **Ferramentas**: Use software de gest√£o financeira\n\nQual o seu maior desafio financeiro atual?";
        }
        
        if (message.includes("rh") || message.includes("recursos humanos") || message.includes("funcion√°rio") || message.includes("equipa") || message.includes("pessoal")) {
            return "üë• **Recursos Humanos**: Pessoas s√£o o ativo mais valioso! Focos:\n\n‚Ä¢ **Recrutamento**: Processos claros e eficientes\n‚Ä¢ **Avalia√ß√£o**: Feedback regular e construtivo\n‚Ä¢ **Desenvolvimento**: Investir em forma√ß√£o\n‚Ä¢ **Reten√ß√£o**: Ambiente positivo e reconhecimento\n\nComo est√° a satisfa√ß√£o da sua equipa?";
        }
        
        if (message.includes("tecnologia") || message.includes("digital") || message.includes("ia") || message.includes("intelig√™ncia artificial") || message.includes("software")) {
            return "üîß **Tecnologia e Inova√ß√£o**: O futuro √© digital! Oportunidades:\n\n‚Ä¢ **Digitaliza√ß√£o**: Automatize processos manuais\n‚Ä¢ **IA**: Chatbots, an√°lise de dados, previs√µes\n‚Ä¢ **Integra√ß√£o**: Conecte todos os sistemas\n‚Ä¢ **Seguran√ßa**: Proteja dados e sistemas\n\nQue processo quer digitalizar primeiro?";
        }
        
        if (message.includes("objetivo") || message.includes("meta") || message.includes("crescimento") || message.includes("futuro")) {
            return "üéØ **Objetivos e Crescimento**: Vamos definir o caminho! Estrat√©gias:\n\n‚Ä¢ **Metas SMART**: Espec√≠ficas, mensur√°veis, ating√≠veis\n‚Ä¢ **Prazos**: Curto (3 meses), m√©dio (1 ano), longo (3+ anos)\n‚Ä¢ **KPIs**: M√©tricas para acompanhar progresso\n‚Ä¢ **Recursos**: O que precisa para atingir objetivos\n\nQual o seu principal objetivo para 2024?";
        }
        
        // Perguntas sobre funcionalidades
        if (message.includes("como") && (message.includes("funciona") || message.includes("usar") || message.includes("preencher"))) {
            return "ü§ñ **Como usar o diagn√≥stico**:\n\n1. **Navega√ß√£o**: Use a barra lateral para saltar entre sec√ß√µes\n2. **Bot√µes IA**: Clique em '‚ú® Sugest√£o com IA' para dicas personalizadas\n3. **An√°lise de Sentimento**: Use 'üé≠' para analisar o tom das suas respostas\n4. **Progresso**: Acompanhe na barra superior\n5. **Chat**: Estou sempre aqui para ajudar!\n\nQual funcionalidade quer explorar?";
        }
        
        // Perguntas sobre IA
        if (message.includes("ia") || message.includes("intelig√™ncia") || message.includes("sugest√£o") || message.includes("recomenda√ß√£o")) {
            return "üß† **Sobre as funcionalidades de IA**:\n\n‚Ä¢ **Sugest√µes personalizadas**: Baseadas no seu setor e contexto\n‚Ä¢ **An√°lise de sentimento**: Identifica tom positivo/negativo\n‚Ä¢ **Chat inteligente**: Respostas contextuais em tempo real\n‚Ä¢ **Recomenda√ß√µes**: Estrat√©gias espec√≠ficas para cada √°rea\n\nA IA adapta-se ao seu perfil empresarial. Experimente os bot√µes ‚ú® em cada campo!";
        }
        
        // Problemas ou dificuldades
        if (message.includes("problema") || message.includes("dificuldade") || message.includes("n√£o sei") || message.includes("d√∫vida")) {
            const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"] h3`);
            const stepTitle = currentStepElement ? currentStepElement.textContent.match(/\d+\.\s*(.*)/)[1] : "etapa atual";
            return `üÜò **Precisa de ajuda?** Estou aqui para isso!\n\nNa sec√ß√£o "${stepTitle}":\n‚Ä¢ Use os bot√µes ‚ú® para sugest√µes espec√≠ficas\n‚Ä¢ Seja o mais detalhado poss√≠vel\n‚Ä¢ Pense no impacto no seu neg√≥cio\n‚Ä¢ N√£o h√° respostas certas ou erradas\n\nQual campo espec√≠fico est√° a causar dificuldade?`;
        }
        
        // Agradecimentos
        if (message.includes("obrigado") || message.includes("obrigada") || message.includes("valeu") || message.includes("thanks")) {
            return "üòä De nada! Fico feliz em ajudar. Lembre-se: quanto mais detalhado for nas respostas, mais personalizado ser√° o seu diagn√≥stico final. Continue com confian√ßa!";
        }
        
        // Perguntas sobre resultados
        if (message.includes("resultado") || message.includes("relat√≥rio") || message.includes("diagn√≥stico") || message.includes("an√°lise")) {
            return "üìã **Sobre o diagn√≥stico final**:\n\nAp√≥s completar todas as sec√ß√µes, receber√°:\n‚Ä¢ **An√°lise detalhada** de cada √°rea\n‚Ä¢ **Pontos fortes** identificados\n‚Ä¢ **Oportunidades** de melhoria\n‚Ä¢ **Recomenda√ß√µes espec√≠ficas** com IA\n‚Ä¢ **Plano de a√ß√£o** priorit√°rio\n\nO relat√≥rio ser√° personalizado com base nas suas respostas!";
        }
        
        // Contexto da etapa atual
        if (message.includes("ajuda") || message.includes("help")) {
            const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"] h3`);
            const stepTitle = currentStepElement ? currentStepElement.textContent.match(/\d+\.\s*(.*)/)[1] : "etapa atual";
            return `üí° **Ajuda para "${stepTitle}"**:\n\nDicas espec√≠ficas:\n‚Ä¢ Seja espec√≠fico e detalhado\n‚Ä¢ Pense no impacto real no neg√≥cio\n‚Ä¢ Use os bot√µes ‚ú® para sugest√µes\n‚Ä¢ Considere tend√™ncias do seu setor\n\nEm que posso ajudar especificamente?`;
        }
        
        // Respostas inteligentes baseadas em palavras-chave
        const keywordResponses = {
            "automa√ß√£o": "ü§ñ Automa√ß√£o √© fundamental! Identifique tarefas repetitivas: emails, relat√≥rios, entrada de dados. Comece pelo que consome mais tempo.",
            "concorr√™ncia": "üèÜ An√°lise competitiva √© crucial! Estude pre√ßos, servi√ßos, marketing dos concorrentes. Encontre o seu diferencial √∫nico.",
            "inova√ß√£o": "üí° Inova√ß√£o n√£o √© s√≥ tecnologia! Pode ser novo processo, servi√ßo, forma de atendimento. O que os clientes realmente precisam?",
            "produtividade": "‚ö° Para aumentar produtividade: elimine reuni√µes desnecess√°rias, automatize tarefas, use ferramentas certas, defina prioridades claras.",
            "qualidade": "‚≠ê Qualidade √© diferencial! Implemente controles, colete feedback, treine equipa, monitore indicadores. Cliente satisfeito volta sempre.",
            "vendas": "üíº Para aumentar vendas: conhe√ßa bem o cliente, melhore follow-up, use CRM, treine equipa, otimize funil de vendas.",
            "custos": "üí∏ Controlo de custos: categorize gastos, negocie fornecedores, elimine desperd√≠cios, monitore mensalmente, invista no que gera retorno."
        };
        
        for (const [keyword, response] of Object.entries(keywordResponses)) {
            if (message.includes(keyword)) {
                return response;
            }
        }
        
        // Respostas contextuais mais inteligentes
        const smartResponses = [
            `Interessante perspectiva! Para o seu contexto espec√≠fico, recomendo focar em: 1) Identificar o impacto real no neg√≥cio, 2) Considerar recursos dispon√≠veis, 3) Definir m√©tricas de sucesso. Quer explorar algum destes pontos?`,
            `Boa quest√£o! No seu setor, isso √© particularmente relevante. Sugiro: analisar casos de sucesso similares, avaliar ROI potencial, e come√ßar com um piloto pequeno. Precisa de exemplos espec√≠ficos?`,
            `Entendo a sua preocupa√ß√£o. Baseado na minha experi√™ncia, empresas similares resolveram isso atrav√©s de: planejamento estruturado, envolvimento da equipa, e implementa√ß√£o gradual. Quer que detalhe alguma estrat√©gia?`,
            `Excelente ponto! Para maximizar resultados, considere: 1) Alinhar com objetivos estrat√©gicos, 2) Envolver stakeholders chave, 3) Medir progresso regularmente. Em qual √°rea quer focar primeiro?`,
            `Muito relevante para o diagn√≥stico! Recomendo documentar: situa√ß√£o atual, objetivos desejados, recursos necess√°rios, e cronograma realista. Posso ajudar a estruturar algum destes elementos?`
        ];
        
        return smartResponses[Math.floor(Math.random() * smartResponses.length)];
    }

    function setupAIModal() {
        const aiModal = document.getElementById('ai-modal');
        const closeAIModalXBtn = document.getElementById('close-ai-modal');
        const closeAIModalBottomBtn = document.getElementById('close-ai-modal-btn');
        const applyAISuggestionBtn = document.getElementById('apply-ai-suggestion');

        if (closeAIModalXBtn) closeAIModalXBtn.addEventListener('click', closeAIFieldModal);
        if (closeAIModalBottomBtn) closeAIModalBottomBtn.addEventListener('click', closeAIFieldModal);
        if (applyAISuggestionBtn) applyAISuggestionBtn.addEventListener('click', applyAIFieldSuggestion);
    }
    
    function handleAIAssistClick(event) {
        const fieldName = event.currentTarget.dataset.field;
        openAIFieldModal(fieldName);
    }
    
    function openAIFieldModal(fieldName) {
        currentAIInteractionField = fieldName;
        const fieldElement = document.querySelector(`[name="${fieldName}"]`);
        let fieldLabelText = fieldName; // Fallback

        if (fieldElement) {
            const label = document.querySelector(`label[for="${fieldElement.id}"]`);
            if (label) fieldLabelText = label.textContent.replace('*','').trim();
        }
        
        const aiModal = document.getElementById('ai-modal');
        const aiModalSubtitle = document.getElementById('ai-modal-subtitle');
        const aiResponseDiv = document.getElementById('ai-response');
        const applyBtn = document.getElementById('apply-ai-suggestion');

        if (aiModalSubtitle) aiModalSubtitle.textContent = `Assist√™ncia IA para: ${fieldLabelText}`;
        if (aiResponseDiv) aiResponseDiv.innerHTML = `<div class="flex items-center space-x-2 text-gray-500 dark:text-gray-400"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"></div><span>A obter sugest√£o da IA para ${fieldLabelText}...</span></div>`;
        if (applyBtn) applyBtn.classList.add('hidden');
        if (aiModal) aiModal.classList.remove('hidden');

        setTimeout(() => { // Simular chamada √† API da IA
            const suggestion = getAISuggestionForField(fieldName, fieldElement ? fieldElement.value : "");
            if (aiResponseDiv) aiResponseDiv.innerHTML = `<p class="text-sm">${suggestion}</p>`;
            if (applyBtn && fieldElement && (fieldElement.tagName === 'INPUT' || fieldElement.tagName === 'TEXTAREA')) {
                applyBtn.classList.remove('hidden');
            }
        }, 1500);
    }

    function closeAIFieldModal() {
        const aiModal = document.getElementById('ai-modal');
        if (aiModal) aiModal.classList.add('hidden');
        currentAIInteractionField = null;
    }

    function applyAIFieldSuggestion() {
        const aiResponseDiv = document.getElementById('ai-response');
        if (currentAIInteractionField && aiResponseDiv) {
            const field = document.querySelector(`[name="${currentAIInteractionField}"]`);
            const suggestionText = aiResponseDiv.querySelector('p')?.textContent; // Pega o texto da sugest√£o
            if (field && suggestionText && (field.tagName === 'INPUT' || field.tagName === 'TEXTAREA')) {
                field.value = suggestionText;
                field.focus(); // Focar no campo ap√≥s aplicar
            }
        }
        closeAIFieldModal();
    }

    function getAISuggestionForField(fieldName, currentValue) {
        // L√≥gica de sugest√µes mais elaborada
        const baseSuggestions = {
            company_name: `Para o nome da empresa, pense em algo que seja memor√°vel, reflita a sua marca e, se poss√≠vel, indique o seu nicho. Ex: "InovaTech Solu√ß√µes", "Sabor & Arte Confeitaria". Se j√° tem um, √≥timo!`,
            sector: `Escolher o setor correto ajuda a direcionar a an√°lise. Se for "Outro", tente descrever brevemente o seu nicho no campo de produtos/servi√ßos.`,
            company_size: `O porte da empresa influencia as estrat√©gias. Seja o mais preciso poss√≠vel. "Ex: 1-9" para micro, "10-49" para pequena, etc.`,
            main_products: `Liste os 2-3 produtos ou servi√ßos que geram mais receita ou que s√£o o foco da sua empresa. Ex: "Consultoria de Marketing Digital, Desenvolvimento de Websites, Gest√£o de Redes Sociais".`,
            target_audience: `Descreva o seu cliente ideal. Ex: "Pequenas e m√©dias empresas do setor de varejo que buscam aumentar a sua presen√ßa online." Considere idade, interesses, problemas que resolve.`,
            internal_processes: `Pense nos fluxos de trabalho mais comuns. Ex: "Recebimento do pedido > Produ√ß√£o > Controlo de Qualidade > Embalagem > Envio > P√≥s-venda". Tente identificar 2-3 processos chave.`,
            tools_software: `Quais programas ou plataformas s√£o essenciais no seu dia a dia? Ex: "CRM (Pipedrive), Email (Gmail), Comunica√ß√£o (Slack), Gest√£o de Projetos (Asana), Finan√ßas (Excel)".`,
            operational_bottlenecks: `Onde √© que o trabalho "emperra"? Ex: "Aprova√ß√£o de or√ßamentos muito demorada", "Falta de comunica√ß√£o entre departamentos", "Sistema de invent√°rio desatualizado".`,
            automation_opportunities: `Que tarefas manuais e repetitivas consomem muito tempo? Ex: "Enviar emails de follow-up", "Gerar relat√≥rios semanais de vendas", "Copiar dados entre planilhas".`,
            
            // Marketing
            marketingChannels: `Liste todos os canais que utiliza atualmente. Ex: "Instagram, Facebook, LinkedIn, Google Ads, Email Marketing, Site pr√≥prio, Vendas diretas, Parcerias com influencers". Inclua tanto digitais quanto tradicionais.`,
            marketingStrategies: `Descreva as suas estrat√©gias principais. Ex: "Conte√∫do educativo no Instagram, Email marketing semanal, SEO no site, Campanhas pagas no Google, Networking em eventos do setor". Foque nas que geram mais resultados.`,
            salesPerformance: `Seja espec√≠fico com m√©tricas. Ex: "ROI de 3:1 no Google Ads, 15% de convers√£o no email, 500 seguidores/m√™s no Instagram, 20% do tr√°fego vem do SEO". Inclua desafios como "baixa convers√£o" ou "custo alto por lead".`,
            crmUsed: `Se usa CRM, mencione qual e como. Ex: "HubSpot para leads, Pipedrive para vendas, WhatsApp Business para atendimento". Se n√£o usa, explique como acompanha clientes: "Planilha Excel, agenda no celular".`,
            marketing_channels: `Liste todos os canais que utiliza atualmente. Ex: "Instagram, Facebook, LinkedIn, Google Ads, Email Marketing, Site pr√≥prio, Vendas diretas, Parcerias com influencers". Inclua tanto digitais quanto tradicionais.`,
            marketing_strategies: `Descreva as suas estrat√©gias principais. Ex: "Conte√∫do educativo no Instagram, Email marketing semanal, SEO no site, Campanhas pagas no Google, Networking em eventos do setor". Foque nas que geram mais resultados.`,
            marketing_performance: `Seja espec√≠fico com m√©tricas. Ex: "ROI de 3:1 no Google Ads, 15% de convers√£o no email, 500 seguidores/m√™s no Instagram, 20% do tr√°fego vem do SEO". Inclua desafios como "baixa convers√£o" ou "custo alto por lead".`,
            crm_usage: `Se usa CRM, mencione qual e como. Ex: "HubSpot para leads, Pipedrive para vendas, WhatsApp Business para atendimento". Se n√£o usa, explique como acompanha clientes: "Planilha Excel, agenda no celular".`,
            
            // Financeiro
            mainExpenses: `Categorize os principais custos. Ex: "Folha de pagamento (40%), Aluguel (15%), Marketing (10%), Fornecedores (20%), Tecnologia (5%)". Identifique os que mais impactam o or√ßamento.`,
            revenueSources: `Liste todas as fontes de receita. Ex: "Vendas diretas (60%), Assinaturas mensais (25%), Consultorias (10%), Cursos online (5%)". Indique a % de cada uma se poss√≠vel.`,
            financialChallenges: `Seja honesto sobre os desafios. Ex: "Fluxo de caixa irregular, Sazonalidade nas vendas, Inadimpl√™ncia de 8%, Custos fixos altos, Dificuldade para precificar". Priorize os mais cr√≠ticos.`,
            financialTools: `Mencione todas as ferramentas. Ex: "Conta Azul para faturamento, Excel para controlo, Banco digital para pagamentos, PagSeguro para recebimentos". Inclua limita√ß√µes se houver.`,
            main_expenses: `Categorize os principais custos. Ex: "Folha de pagamento (40%), Aluguel (15%), Marketing (10%), Fornecedores (20%), Tecnologia (5%)". Identifique os que mais impactam o or√ßamento.`,
            revenue_sources: `Liste todas as fontes de receita. Ex: "Vendas diretas (60%), Assinaturas mensais (25%), Consultorias (10%), Cursos online (5%)". Indique a % de cada uma se poss√≠vel.`,
            financial_challenges: `Seja honesto sobre os desafios. Ex: "Fluxo de caixa irregular, Sazonalidade nas vendas, Inadimpl√™ncia de 8%, Custos fixos altos, Dificuldade para precificar". Priorize os mais cr√≠ticos.`,
            financial_tools: `Mencione todas as ferramentas. Ex: "Conta Azul para faturamento, Excel para controlo, Banco digital para pagamentos, PagSeguro para recebimentos". Inclua limita√ß√µes se houver.`,
            
            // RH
            recruitment_process: `Descreva como recruta. Ex: "LinkedIn, indica√ß√µes, site de empregos, processo: triagem > entrevista > teste pr√°tico > contrata√ß√£o". Inclua tempo m√©dio e desafios.`,
            performance_evaluation: `Como avalia a equipa? Ex: "Reuni√µes mensais 1:1, Metas trimestrais, Feedback 360¬∞, Avalia√ß√£o anual com aumento salarial". Se n√£o tem processo formal, mencione.`,
            hr_challenges: `Principais dificuldades com pessoas. Ex: "Alta rotatividade, Dificuldade para encontrar talentos, Motiva√ß√£o da equipa, Comunica√ß√£o entre departamentos, Falta de plano de carreira".`,
            hr_software: `Ferramentas de RH que usa. Ex: "Gupy para recrutamento, Factorial para gest√£o, Slack para comunica√ß√£o, Google Workspace para colabora√ß√£o". Se usa planilhas, mencione.`,
            
            // Tecnologia
            digitalizationLevel: `Avalie honestamente. Baixo: processos manuais, papel. M√©dio: alguns sistemas, mas desconectados. Alto: processos digitais integrados, automa√ß√£o, dados centralizados.`,
            aiUsage: `Seja espec√≠fico sobre IA. Ex: "ChatGPT para textos, Canva Magic para design, chatbot no site, an√°lise de dados com IA". Se n√£o usa, mencione interesse: "Queremos explorar chatbots".`,
            techChallenges: `Problemas tecnol√≥gicos reais. Ex: "Sistemas n√£o conversam entre si, Dados espalhados, Seguran√ßa fraca, Equipa sem conhecimento t√©cnico, Or√ßamento limitado para tecnologia".`,
            tech_budget: `Seja realista sobre investimento. Considere: necessidades atuais, ROI esperado, capacidade financeira, urg√™ncia das melhorias. Baixo n√£o √© problema se bem justificado.`,
            digitalization_level: `Avalie honestamente. Baixo: processos manuais, papel. M√©dio: alguns sistemas, mas desconectados. Alto: processos digitais integrados, automa√ß√£o, dados centralizados.`,
            ai_usage: `Seja espec√≠fico sobre IA. Ex: "ChatGPT para textos, Canva Magic para design, chatbot no site, an√°lise de dados com IA". Se n√£o usa, mencione interesse: "Queremos explorar chatbots".`,
            tech_challenges: `Problemas tecnol√≥gicos reais. Ex: "Sistemas n√£o conversam entre si, Dados espalhados, Seguran√ßa fraca, Equipa sem conhecimento t√©cnico, Or√ßamento limitado para tecnologia".`,
            
            // Objetivos
            business_objectives: `Metas espec√≠ficas e mensur√°veis. Ex: "Aumentar faturamento em 30% em 12 meses, Lan√ßar 2 novos produtos, Abrir filial em SP, Atingir 10k seguidores, Reduzir custos em 15%". Inclua prazos.`,
            growth_timeline: `Cronograma realista. Ex: "3 meses: novo site, 6 meses: equipa de vendas, 12 meses: expans√£o geogr√°fica". Considere recursos dispon√≠veis e prioridades.`,
            success_metrics: `Como vai medir sucesso? Ex: "Receita mensal, NPS dos clientes, N√∫mero de leads, Margem de lucro, Produtividade da equipa". Defina metas num√©ricas espec√≠ficas.`,
            
            default: `Para este campo, tente fornecer informa√ß√µes claras e concisas. Pense em como isso impacta o seu neg√≥cio e os seus objetivos.`
        };
        let suggestion = baseSuggestions[fieldName] || baseSuggestions.default;
        if (currentValue && currentValue.length > 10) {
            suggestion += ` <br><br><em>Voc√™ j√° preencheu: "${currentValue.substring(0, 50)}...". A IA pode ajudar a refinar ou expandir isso.</em>`;
        }
        return suggestion;
    }

    // --- An√°lise de Sentimento ---
    function handleSentimentAnalysisClick(event) {
        const fieldName = event.currentTarget.dataset.field;
        const field = document.querySelector(`[name="${fieldName}"]`);
        if (field && field.value.trim()) {
            const text = field.value.trim();
            // Simula√ß√£o de chamada √† API de sentimento
            showTemporaryMessage(`A analisar sentimento para "${fieldName.replace(/_/g, ' ')}"...`, 'info', 1500);
            setTimeout(() => {
                const sentiment = getSentimentForText(text); // Renomeado
                displaySentimentResult(field, sentiment, fieldName);
            }, 1800);
        } else {
            showTemporaryMessage('Por favor, preencha o campo antes de fazer a an√°lise de sentimento.', 'warning');
        }
    }

    function getSentimentForText(text) { // Renomeado
        const positiveWords = ['bom', '√≥timo', 'excelente', 'sucesso', 'crescimento', 'oportunidade', 'eficiente', 'qualidade', 'lucro', 'positivo', 'ideal', 'feliz', 'satisfeito', 'resolver', 'melhorar', 'inovar'];
        const negativeWords = ['problema', 'dificuldade', 'desafio', 'ruim', 'p√©ssimo', 'falha', 'erro', 'preju√≠zo', 'lento', 'negativo', 'baixo', 'insatisfeito', 'preocupado', 'gargalo', 'custo alto'];
        
        const words = text.toLowerCase().match(/\b(\w+)\b/g) || []; // Apenas palavras
        let score = 0;
        words.forEach(word => {
            if (positiveWords.includes(word)) score++;
            if (negativeWords.includes(word)) score--;
        });

        if (score > 1) return { label: 'Muito Positivo', emoji: 'üòÉ', class: 'bg-green-100 dark:bg-green-800/50 text-green-700 dark:text-green-300', description: 'O texto expressa um forte otimismo e potencial.' };
        if (score === 1) return { label: 'Positivo', emoji: 'üòä', class: 'bg-green-100 dark:bg-green-800/50 text-green-700 dark:text-green-300', description: 'O texto demonstra uma perspectiva construtiva.' };
        if (score < -1) return { label: 'Muito Negativo', emoji: 'üòü', class: 'bg-red-100 dark:bg-red-800/50 text-red-700 dark:text-red-300', description: 'O texto indica fortes preocupa√ß√µes ou desafios significativos.' };
        if (score === -1) return { label: 'Negativo', emoji: 'üòï', class: 'bg-red-100 dark:bg-red-800/50 text-red-700 dark:text-red-300', description: 'O texto aponta para √°reas que podem precisar de aten√ß√£o.' };
        return { label: 'Neutro', emoji: 'üòê', class: 'bg-gray-100 dark:bg-gray-700/50 text-gray-700 dark:text-gray-300', description: 'O texto apresenta um tom equilibrado ou n√£o possui uma carga sentimental clara.' };
    }

    function displaySentimentResult(fieldElement, sentiment, fieldName) {
        const resultDivId = `sentiment-result-${fieldName}`;
        let resultDiv = document.getElementById(resultDivId);
        if (!resultDiv) {
            resultDiv = document.createElement('div');
            resultDiv.id = resultDivId;
            resultDiv.classList.add('mt-2', 'p-3', 'rounded-lg', 'sentiment-result', 'transition-all', 'duration-300', 'ease-in-out');
            // Inserir ap√≥s o √∫ltimo bot√£o daquele campo (seja AI assist ou sentiment)
            const parentDiv = fieldElement.closest('div');
            const buttonsInDiv = parentDiv.querySelectorAll('button');
            if (buttonsInDiv.length > 0) {
                buttonsInDiv[buttonsInDiv.length -1].insertAdjacentElement('afterend', resultDiv);
            } else {
                 fieldElement.insertAdjacentElement('afterend', resultDiv);
            }
        }
        
        resultDiv.className = `mt-2 p-3 rounded-lg sentiment-result transition-all duration-300 ease-in-out text-sm ${sentiment.class}`;
        resultDiv.innerHTML = `
            <p class="font-medium flex items-center"><span class="text-xl mr-2">${sentiment.emoji}</span> An√°lise de Sentimento: ${sentiment.label}</p>
            <p class="text-xs mt-1 opacity-80">${sentiment.description}</p>
        `;
        // For√ßar reflow para reiniciar a anima√ß√£o se a classe mudar
        void resultDiv.offsetWidth;
        resultDiv.style.opacity = '1';
        resultDiv.style.transform = 'translateY(0)';
    }

    // --- Anima√ß√µes de Entrada ---
    function setupIntersectionObserver() {
        const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -30px 0px' };
        const observer = new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                    obs.unobserve(entry.target); // Animar apenas uma vez
                }
            });
        }, observerOptions);

        document.querySelectorAll('.glass-container, .form-step > div > div > div, .report-item-card').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
            observer.observe(el);
        });
    }
    
    // --- Webhook Integration ---
    async function sendToWebhook(formData) {
        try {
            const webhookData = {
                user_name: formData.user_name,
                user_whatsapp: formData.user_whatsapp,
                company_name: formData.company_name,
                sector: formData.sector,
                company_size: formData.company_size,
                main_products: formData.main_products,
                target_audience: formData.target_audience,
                submitted_at: new Date().toISOString(),
                form_data: formData // Dados completos do formul√°rio
            };

            const response = await fetch('https://webhook.n8n.alifa.com.br/webhook/ia_analizer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(webhookData)
            });

            if (response.ok) {
                console.log('Dados enviados com sucesso para o webhook');
                showTemporaryMessage('Relat√≥rio ser√° enviado para seu WhatsApp em breve!', 'success');
            } else {
                console.error('Erro ao enviar dados para o webhook:', response.status);
                showTemporaryMessage('Erro ao processar envio. Tente novamente.', 'error');
            }
        } catch (error) {
            console.error('Erro na requisi√ß√£o para o webhook:', error);
            showTemporaryMessage('Erro de conex√£o. Verifique sua internet.', 'error');
        }
    }

    // --- Mensagens Tempor√°rias ---
    function showTemporaryMessage(message, type = 'info', duration = 3000) {
        const existingMessage = document.querySelector('.temp-message-overlay');
        if (existingMessage) existingMessage.remove();

        const messageDiv = document.createElement('div');
        messageDiv.className = 'temp-message-overlay fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg text-white text-sm z-[2000]';
        
        if (type === 'error') messageDiv.classList.add('bg-red-500');
        else if (type === 'warning') messageDiv.classList.add('bg-yellow-500', 'text-black');
        else if (type === 'success') messageDiv.classList.add('bg-green-500');
        else messageDiv.classList.add('bg-blue-500'); // info
        
        messageDiv.textContent = message;
        document.body.appendChild(messageDiv);
        
        setTimeout(() => {
            messageDiv.style.opacity = '0';
            messageDiv.style.transform = 'translateY(-20px) translateX(-50%)'; // Anima√ß√£o de sa√≠da
            setTimeout(() => messageDiv.remove(), 300);
        }, duration);
    }

</script>
</body>
</html>
```

Espero que isto ajude a testar a aplica√ß√£o diretamente na plataforma! Se encontrar algum problema ou tiver mais alguma quest√£o, diga-