<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico Empresarial Inteligente PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Cores para o tema claro - Melhor contraste */
            --light-bg: #ffffff; 
            --light-card-bg: rgba(249, 250, 251, 0.95); 
            --light-text-primary: #111827; 
            --light-text-secondary: #374151; 
            --light-text-tertiary: #6b7280; 
            --light-border: #d1d5db; 
            --light-input-bg: #ffffff;
            --light-input-border: #cbd5e1; 
            
            /* Cores para o tema escuro */
            --dark-bg: #0d1117;  
            --dark-card-bg: rgba(22, 27, 34, 0.95); 
            --dark-text-primary: #e6edf3;  
            --dark-text-secondary: #909dab; 
            --dark-text-tertiary: #768390;
            --dark-border: #30363d;  
            --dark-input-bg: #161b22;
            --dark-input-border: #4b5563; 

            /* Gradientes de botões vibrantes */
            --accent-gradient-start: #4f46e5; 
            --accent-gradient-end: #a855f7;   
            --success-gradient-start: #16a34a; 
            --success-gradient-end: #10b981;   

            /* Cores para o Relatório e ícones */
            --color-perigo: #ef4444;       /* red-500 */
            --color-oportunidade: #f59e0b; /* amber-500 */
            --color-desafio: #f97316;      /* orange-500 */
            --color-solucao: #22c55e;      /* green-500 */
            --color-explorar: #3b82f6;     /* blue-500 */
            --color-apontamento: #6366f1;  /* indigo-500 - Para "Apontamentos" se precisar de uma cor distinta */
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.4s, color 0.4s;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden; /* Prevenir scroll horizontal */
        }

        .hidden { display: none !important; }

        .light { background-color: var(--light-bg); color: var(--light-text-primary); }
        .dark { background-color: var(--dark-bg); color: var(--dark-text-primary); }

        .welcome-screen-bg { background-size: 250% 250%; animation: animatedGradientBG 30s ease infinite; }
        .light .welcome-screen-bg { background-image: linear-gradient(135deg, #e0e7ff, #f8fafc, #d1d8e0, #f8fafc, #e0e7ff); }
        .dark .welcome-screen-bg { background-image: linear-gradient(135deg, #1c2128, #0d1117, #21262d, #0d1117, #1c2128); }
        
        .animated-title-h1 { font-weight: 800; background-image: linear-gradient(100deg, var(--accent-gradient-start), var(--accent-gradient-end), var(--accent-gradient-start)); background-size: 200% auto; color: transparent; background-clip: text; -webkit-background-clip: text; animation: animatedTextGradient 7s linear infinite; }
        .animated-title-header { font-weight: 700; background-image: linear-gradient(100deg, var(--accent-gradient-start), var(--accent-gradient-end), var(--accent-gradient-start)); background-size: 200% auto; color: transparent; background-clip: text; -webkit-background-clip: text; animation: animatedTextGradient 9s linear infinite; }
        
        .glass-container { backdrop-filter: blur(18px) saturate(170%); -webkit-backdrop-filter: blur(18px) saturate(170%); border-radius: 1rem; }
        .light .glass-container { background-color: var(--light-card-bg); border: 1px solid var(--light-border); box-shadow: 0 8px 24px -8px rgba(108, 117, 125, 0.1), 0 16px 32px -16px rgba(108, 117, 125, 0.08); }
        .dark .glass-container { background-color: var(--dark-card-bg); border: 1px solid var(--dark-border); box-shadow: 0 8px 24px -8px rgba(0, 0, 0, 0.3), 0 16px 32px -16px rgba(0, 0, 0, 0.25); }
        
        .button-primary { background-image: linear-gradient(120deg, var(--accent-gradient-start) 0%, var(--accent-gradient-end) 100%); transition: all 0.4s ease; box-shadow: 0 4px 20px 0 rgba(168, 85, 247, 0.35); color:white; }
        .button-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 7px 25px 0 rgba(168, 85, 247, 0.5); }
        .button-success { background-image: linear-gradient(120deg, var(--success-gradient-start) 0%, var(--success-gradient-end) 100%); transition: all 0.4s ease; box-shadow: 0 4px 20px 0 rgba(22, 163, 74, 0.35); color:white; }
        .button-success:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 7px 25px 0 rgba(22, 163, 74, 0.5); }
        
        .light .button-secondary { background-color: #e5e7eb; color: var(--light-text-primary); border: 1px solid #d1d5db; } 
        .dark .button-secondary { background-color: #21262d; color: var(--dark-text-primary); border: 1px solid #30363d; } 
        .light .button-secondary:hover:not(:disabled) { background-color: #d1d5db; } 
        .dark .button-secondary:hover:not(:disabled) { background-color: #30363d; }
        
        .light input, .light textarea, .light select { background-color: var(--light-input-bg); border: 1px solid var(--light-input-border); color: var(--light-text-primary); } 
        .dark input, .dark textarea, .dark select { background-color: var(--dark-input-bg); border: 1px solid var(--dark-input-border); color: var(--dark-text-primary); } 
        .light input::placeholder, .light textarea::placeholder { color: var(--light-text-tertiary); } 
        .dark input::placeholder, .dark textarea::placeholder { color: var(--dark-text-tertiary); }
        .light input:focus, .light textarea:focus, .light select:focus { border-color: var(--accent-gradient-start); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2); outline: none; } 
        .dark input:focus, .dark textarea:focus, .dark select:focus { border-color: var(--accent-gradient-start); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.25); outline: none; }
        
        .report-item-card {
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-left-width: 5px;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            display: flex;
            align-items: flex-start;
        }
        .report-item-card:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 10px 20px -5px rgba(0,0,0,0.1);
        }
        .light .report-item-card { background-color: var(--light-card-bg); box-shadow: 0 4px 8px -2px rgba(0,0,0,0.07), 0 2px 6px -2px rgba(0,0,0,0.04); }
        .dark .report-item-card { background-color: var(--dark-card-bg); box-shadow: 0 4px 8px -2px rgba(0,0,0,0.25), 0 2px 6px -2px rgba(0,0,0,0.2); }
        .dark .report-item-card:hover { box-shadow: 0 10px 20px -5px rgba(0,0,0,0.35); }

        .report-item-icon {
            font-size: 1.75rem; /* Ajustado para melhor alinhamento com o texto */
            margin-right: 1rem;
            margin-top: 0.25rem; /* Pequeno ajuste para alinhar melhor com a primeira linha do título */
            flex-shrink: 0;
        }
        .report-item-content { flex-grow: 1; }
        .report-item-title { font-size: 1.125rem; font-weight: 600; margin-bottom: 0.35rem; }
        .report-item-description { font-size: 0.9rem; line-height: 1.65; }
        
        .light .report-item-title { color: var(--light-text-primary); }
        .dark .report-item-title { color: var(--dark-text-primary); }
        .light .report-item-description { color: var(--light-text-secondary); }
        .dark .report-item-description { color: var(--dark-text-secondary); }

        /* Cores específicas para cada categoria no relatório em tela */
        .report-item-card.perigo { border-left-color: var(--color-perigo); }
        .report-item-card.perigo .report-item-icon { color: var(--color-perigo); }
        .report-item-card.oportunidade { border-left-color: var(--color-oportunidade); }
        .report-item-card.oportunidade .report-item-icon { color: var(--color-oportunidade); }
        .report-item-card.desafio { border-left-color: var(--color-desafio); }
        .report-item-card.desafio .report-item-icon { color: var(--color-desafio); }
        .report-item-card.solucao { border-left-color: var(--color-solucao); }
        .report-item-card.solucao .report-item-icon { color: var(--color-solucao); }
        .report-item-card.explorar { border-left-color: var(--color-explorar); }
        .report-item-card.explorar .report-item-icon { color: var(--color-explorar); }

        /* Estilos para navegação lateral */
        .nav-item {
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .light .nav-item {
            background-color: transparent;
            color: var(--light-text-secondary);
        }
        .dark .nav-item {
            background-color: transparent;
            color: var(--dark-text-secondary);
        }
        .light .nav-item:hover {
            background-color: var(--light-card-bg);
            border-color: var(--light-border);
            color: var(--light-text-primary);
        }
        .dark .nav-item:hover {
            background-color: var(--dark-card-bg);
            border-color: var(--dark-border);
            color: var(--dark-text-primary);
        }
        .nav-item.active {
            background-image: linear-gradient(120deg, var(--accent-gradient-start) 0%, var(--accent-gradient-end) 100%);
            color: white !important;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
            transform: translateX(4px);
        }
        
        /* Estilos para botões de setor */
        .sector-btn {
            padding: 1rem;
            border-radius: 0.75rem;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            font-weight: 500;
        }
        .light .sector-btn {
            background-color: var(--light-card-bg);
            color: var(--light-text-primary);
            border-color: var(--light-border);
        }
        .dark .sector-btn {
            background-color: var(--dark-card-bg);
            color: var(--dark-text-primary);
            border-color: var(--dark-border);
        }
        .sector-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .sector-btn.selected {
            background-image: linear-gradient(120deg, var(--accent-gradient-start) 0%, var(--accent-gradient-end) 100%);
            color: white;
            border-color: var(--accent-gradient-start);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
        }
        
        /* Estilos para botões de IA */
        .ai-assist-btn, .sentiment-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .ai-assist-btn {
            background: linear-gradient(120deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);
        }
        .ai-assist-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        .sentiment-btn {
            background: linear-gradient(120deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 2px 10px rgba(245, 158, 11, 0.3);
        }
        .sentiment-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        
        /* Estilos para etapas do formulário */
        .form-step {
            display: none; /* Controlado por JS e .active */
            animation: fadeInStep 0.5s ease-out;
        }
        .form-step.active {
            display: block;
        }
        
        @keyframes animatedGradientBG { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }
        @keyframes animatedTextGradient { 0% { background-position: 0% center; } 100% { background-position: 200% center; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInStep { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="light min-h-screen">
    <div class="fixed top-4 right-4 z-50">
        <button id="theme-toggle" class="p-3 rounded-full glass-container transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-purple-500">
            <svg id="sun-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg id="moon-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
        </button>
    </div>

    <div id="welcome-screen" class="welcome-screen-bg min-h-screen flex items-center justify-center p-4">
        <div class="glass-container p-8 md:p-12 max-w-2xl w-full text-center">
            <div class="mb-8">
                <div class="w-24 h-24 mx-auto mb-6 rounded-full border-4 border-purple-500 flex items-center justify-center">
                    <svg class="w-12 h-12 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
            </div>

            <h1 class="text-4xl md:text-5xl mb-6 animated-title-h1">Desvende o Futuro do Seu Negócio com IA</h1>
            
            <p class="text-lg md:text-xl mb-12 opacity-80">Responda com atenção e insights. Sua jornada para a máxima eficiência começa agora.</p>
            
            <button id="start-diagnostic" class="button-primary px-8 py-4 rounded-lg font-semibold text-lg mb-8 transition-all duration-300">
                Iniciar Diagnóstico Avançado
            </button>
        </div>
    </div>

    <div id="diagnostic-form" class="min-h-screen p-4 md:p-6 hidden">
        <div class="max-w-6xl mx-auto">
            <div class="glass-container p-6 mb-6 text-center">
                <h2 class="text-3xl font-bold mb-4 animated-title-header">Diagnóstico Empresarial Inteligente</h2>
                <p class="text-lg opacity-80">Preencha as informações abaixo para uma análise personalizada</p>
                
                <div class="mt-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium">Progresso</span>
                        <span id="progress-text" class="text-sm font-medium">1 de 7</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                        <div id="progress-bar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2.5 rounded-full transition-all duration-300" style="width: 14.3%"></div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-6">
                <div class="lg:w-1/4">
                    <div class="glass-container p-4 sticky top-6">
                        <h3 class="font-semibold mb-4 text-lg">Seções do Diagnóstico</h3>
                        <nav class="space-y-2">
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors active" data-step="1">
                                <span class="text-lg mr-2">📊</span> Geral
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="2">
                                <span class="text-lg mr-2">⚙️</span> Processos
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="3">
                                <span class="text-lg mr-2">📈</span> Marketing
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="4">
                                <span class="text-lg mr-2">💰</span> Financeiro
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="5">
                                <span class="text-lg mr-2">👥</span> RH
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="6">
                                <span class="text-lg mr-2">🔧</span> Tecnologia
                            </button>
                            <button class="nav-item w-full text-left px-3 py-2.5 rounded-lg transition-colors" data-step="7">
                                <span class="text-lg mr-2">🎯</span> Objetivos
                            </button>
                        </nav>
                    </div>
                </div>

                <div class="lg:w-3/4">
                    <form id="business-form" class="space-y-6">
                        <div class="form-step active" data-step="1">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center">
                                    <span class="text-2xl mr-3">📊</span>
                                    1. Informações Gerais da Empresa
                                </h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="user_name" class="block text-sm font-medium mb-2">Seu Nome *</label>
                                        <input type="text" id="user_name" name="user_name" required placeholder="Digite seu nome completo" class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                    </div>
                                    <div>
                                        <label for="user_whatsapp" class="block text-sm font-medium mb-2">WhatsApp (com DDD) *</label>
                                        <input type="tel" id="user_whatsapp" name="user_whatsapp" required placeholder="Ex: 11999999999" class="w-full px-4 py-3 rounded-lg border focus:outline-none" pattern="[0-9]{10,11}">
                                        <p class="text-xs text-gray-500 mt-1">Apenas números, sem espaços ou símbolos. Será usado para enviar o relatório.</p>
                                    </div>
                                    <div>
                                        <label for="company_name" class="block text-sm font-medium mb-2">Nome da Empresa *</label>
                                        <input type="text" id="company_name" name="company_name" required placeholder="Digite o nome da sua empresa" class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="company_name">
                                            ✨ Sugestão com IA
                                        </button>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Setor de Atuação *</label>
                                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                            <button type="button" class="sector-btn" data-value="tecnologia"><span class="text-2xl mb-2 block">💻</span>Tecnologia</button>
                                            <button type="button" class="sector-btn" data-value="varejo"><span class="text-2xl mb-2 block">🛍️</span>Varejo</button>
                                            <button type="button" class="sector-btn" data-value="saude"><span class="text-2xl mb-2 block">❤️</span>Saúde</button>
                                            <button type="button" class="sector-btn" data-value="financas"><span class="text-2xl mb-2 block">💼</span>Finanças</button>
                                            <button type="button" class="sector-btn" data-value="educacao"><span class="text-2xl mb-2 block">🎓</span>Educação</button>
                                            <button type="button" class="sector-btn" data-value="outro"><span class="text-2xl mb-2 block">➡️</span>Outro</button>
                                        </div>
                                        <input type="hidden" id="sector" name="sector" required>
                                    </div>
                                    <div>
                                        <label for="company_size" class="block text-sm font-medium mb-2">Porte da Empresa (nº de funcionários) *</label>
                                        <input type="text" id="company_size" name="company_size" required placeholder="Ex: 1-9, 10-49, 50-249, 250+" class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="company_size">
                                            ✨ Analisar com IA
                                        </button>
                                    </div>
                                    <div>
                                        <label for="main_products" class="block text-sm font-medium mb-2">Principais Produtos/Serviços *</label>
                                        <textarea id="main_products" name="main_products" required rows="4" placeholder="Descreva os principais produtos ou serviços oferecidos..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="main_products">
                                            ✨ Gerar ideias com IA
                                        </button>
                                    </div>
                                    <div>
                                        <label for="target_audience" class="block text-sm font-medium mb-2">Público-Alvo Principal *</label>
                                        <textarea id="target_audience" name="target_audience" required rows="3" placeholder="Descreva seu público-alvo (idade, perfil, necessidades...)" class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="target_audience">
                                            ✨ Analisar com IA
                                        </button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="target_audience">
                                            🎭 Análise de Sentimento
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="2">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">⚙️</span>2. Processos e Operações</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="internal_processes" class="block text-sm font-medium mb-2">Principais processos internos da empresa *</label>
                                        <textarea id="internal_processes" name="internal_processes" required rows="4" placeholder="Descreva os fluxos de trabalho mais importantes..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="internal_processes">✨ Otimizar com IA</button>
                                    </div>
                                    <div>
                                        <label for="tools_software" class="block text-sm font-medium mb-2">Ferramentas e softwares mais utilizados *</label>
                                        <textarea id="tools_software" name="tools_software" required rows="3" placeholder="Liste as principais ferramentas (CRM, ERP, comunicação, etc.)..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="tools_software">✨ Sugerir melhorias com IA</button>
                                    </div>
                                    <div>
                                        <label for="operational_bottlenecks" class="block text-sm font-medium mb-2">Principais gargalos operacionais identificados *</label>
                                        <textarea id="operational_bottlenecks" name="operational_bottlenecks" required rows="4" placeholder="Quais são os principais obstáculos que impedem maior eficiência?" class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="operational_bottlenecks">✨ Analisar soluções com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="operational_bottlenecks">🎭 Análise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="automation_opportunities" class="block text-sm font-medium mb-2">Tarefas repetitivas com potencial de automação *</label>
                                        <textarea id="automation_opportunities" name="automation_opportunities" required rows="3" placeholder="Identifique tarefas manuais e repetitivas que poderiam ser automatizadas..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="automation_opportunities">✨ Sugerir automações com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="3">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">📈</span>3. Marketing e Vendas</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="marketing_channels" class="block text-sm font-medium mb-2">Canais de marketing e vendas utilizados *</label>
                                        <textarea id="marketing_channels" name="marketing_channels" required rows="3" placeholder="Redes sociais, site, email marketing, vendas diretas, parcerias..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="marketing_channels">✨ Otimizar canais com IA</button>
                                    </div>
                                    <div>
                                        <label for="marketing_strategies" class="block text-sm font-medium mb-2">Principais estratégias de marketing e vendas *</label>
                                        <textarea id="marketing_strategies" name="marketing_strategies" required rows="4" placeholder="Descreva suas estratégias atuais (Inbound, Outbound, Conteúdo, etc.)..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="marketing_strategies">✨ Melhorar estratégias com IA</button>
                                    </div>
                                    <div>
                                        <label for="marketing_performance" class="block text-sm font-medium mb-2">Performance atual de marketing e vendas *</label>
                                        <textarea id="marketing_performance" name="marketing_performance" required rows="3" placeholder="Como está o desempenho? Métricas, resultados, desafios..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="marketing_performance">✨ Analisar performance com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="marketing_performance">🎭 Análise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="crm_usage" class="block text-sm font-medium mb-2">Utiliza alguma ferramenta de CRM? Qual? *</label>
                                        <input type="text" id="crm_usage" name="crm_usage" required placeholder="Ex: HubSpot, Salesforce, Pipedrive, RD Station, não utiliza..." class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="crm_usage">✨ Sugerir CRM com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="4">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">💰</span>4. Gestão Financeira</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="main_expenses" class="block text-sm font-medium mb-2">Principais despesas e custos da empresa *</label>
                                        <textarea id="main_expenses" name="main_expenses" required rows="4" placeholder="Folha de pagamento, aluguel, marketing, tecnologia, fornecedores..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="main_expenses">✨ Otimizar custos com IA</button>
                                    </div>
                                    <div>
                                        <label for="revenue_sources" class="block text-sm font-medium mb-2">Principais fontes de receita *</label>
                                        <textarea id="revenue_sources" name="revenue_sources" required rows="3" placeholder="Vendas de produtos, serviços, assinaturas, parcerias, etc..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="revenue_sources">✨ Diversificar receitas com IA</button>
                                    </div>
                                    <div>
                                        <label for="financial_challenges" class="block text-sm font-medium mb-2">Maiores desafios financeiros atuais *</label>
                                        <textarea id="financial_challenges" name="financial_challenges" required rows="4" placeholder="Fluxo de caixa, inadimplência, custos altos, lucratividade..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="financial_challenges">✨ Resolver desafios com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="financial_challenges">🎭 Análise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="financial_tools" class="block text-sm font-medium mb-2">Ferramentas de gestão financeira utilizadas *</label>
                                        <input type="text" id="financial_tools" name="financial_tools" required placeholder="Ex: Excel, QuickBooks, Conta Azul, sistema próprio..." class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="financial_tools">✨ Sugerir ferramentas com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="5">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">👥</span>5. Recursos Humanos e Equipa</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="total_employees" class="block text-sm font-medium mb-2">Número total de colaboradores *</label>
                                        <input type="number" id="total_employees" name="total_employees" required placeholder="Ex: 25" class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="total_employees">✨ Analisar estrutura com IA</button>
                                    </div>
                                    <div>
                                        <label for="hr_challenges" class="block text-sm font-medium mb-2">Principais desafios na gestão de pessoas *</label>
                                        <textarea id="hr_challenges" name="hr_challenges" required rows="4" placeholder="Retenção de talentos, motivação, comunicação, treinamento, recrutamento..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="hr_challenges">✨ Resolver desafios de RH com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="hr_challenges">🎭 Análise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="hr_software" class="block text-sm font-medium mb-2">Plataforma ou software para gestão de RH *</label>
                                        <input type="text" id="hr_software" name="hr_software" required placeholder="Ex: Gupy, Sólides, Factorial, sistema próprio, planilhas..." class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                        <button type="button" class="ai-assist-btn mt-2" data-field="hr_software">✨ Sugerir soluções de RH com IA</button>
                                    </div>
                                    <div>
                                        <label for="performance_evaluation" class="block text-sm font-medium mb-2">Como é feita a avaliação de desempenho dos colaboradores? *</label>
                                        <textarea id="performance_evaluation" name="performance_evaluation" required rows="3" placeholder="Processo atual de avaliação, frequência, critérios..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="performance_evaluation">✨ Melhorar avaliações com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="6">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">🔧</span>6. Tecnologia e Inovação</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="digitalization_level" class="block text-sm font-medium mb-2">Nível de digitalização atual da empresa *</label>
                                        <select id="digitalization_level" name="digitalization_level" required class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                            <option value="">Selecione o nível</option>
                                            <option value="basico">Básico (uso de email, planilhas básicas)</option>
                                            <option value="intermediario">Intermediário (alguns sistemas específicos, processos parcialmente digitais)</option>
                                            <option value="avancado">Avançado (maioria dos processos digitalizados, uso de sistemas integrados)</option>
                                            <option value="muito_avancado">Muito Avançado (totalmente digital, cultura data-driven, automação extensiva)</option>
                                        </select>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="digitalization_level">✨ Plano de digitalização com IA</button>
                                    </div>
                                    <div>
                                        <label for="ai_usage" class="block text-sm font-medium mb-2">A empresa já utiliza ou explorou Inteligência Artificial? Como? *</label>
                                        <textarea id="ai_usage" name="ai_usage" required rows="3" placeholder="Chatbots, automação, análise de dados, personalização, ou 'Ainda não utiliza'..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="ai_usage">✨ Oportunidades de IA</button>
                                    </div>
                                    <div>
                                        <label for="tech_challenges" class="block text-sm font-medium mb-2">Principais desafios tecnológicos enfrentados *</label>
                                        <textarea id="tech_challenges" name="tech_challenges" required rows="4" placeholder="Sistemas legados, segurança de dados, integração de ferramentas, falta de conhecimento técnico..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="tech_challenges">✨ Resolver desafios tech com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="tech_challenges">🎭 Análise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="tech_budget" class="block text-sm font-medium mb-2">Orçamento anual aproximado para tecnologia e inovação *</label>
                                        <select id="tech_budget" name="tech_budget" required class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                            <option value="">Selecione a faixa de orçamento</option>
                                            <option value="ate_10k">Até R$ 10.000</option>
                                            <option value="10k_50k">R$ 10.001 - R$ 50.000</option>
                                            <option value="50k_100k">R$ 50.001 - R$ 100.000</option>
                                            <option value="100k_500k">R$ 100.001 - R$ 500.000</option>
                                            <option value="acima_500k">Acima de R$ 500.000</option>
                                            <option value="nao_definido">Não definido / Varia muito</option>
                                        </select>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="tech_budget">✨ Otimizar investimento com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" data-step="7">
                            <div class="glass-container p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-6 flex items-center"><span class="text-2xl mr-3">🎯</span>7. Desafios Gerais e Objetivos Futuros</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label for="top_challenges" class="block text-sm font-medium mb-2">Liste os 3 a 5 maiores desafios atuais da empresa (geral) *</label>
                                        <textarea id="top_challenges" name="top_challenges" required rows="5" placeholder="Concorrência, mudanças no mercado, gestão interna, captação de clientes, etc..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="top_challenges">✨ Analisar desafios com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="top_challenges">🎭 Análise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="business_objectives" class="block text-sm font-medium mb-2">Principais objetivos de negócio para os próximos 6-12 meses *</label>
                                        <textarea id="business_objectives" name="business_objectives" required rows="4" placeholder="Aumentar faturamento em X%, lançar novo produto, expandir para nova região, melhorar satisfação do cliente..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="business_objectives">✨ Estratégias para objetivos com IA</button>
                                    </div>
                                    <div>
                                        <label for="consultancy_expectations" class="block text-sm font-medium mb-2">O que espera obter desta consultoria de diagnóstico? *</label>
                                        <textarea id="consultancy_expectations" name="consultancy_expectations" required rows="4" placeholder="Clareza sobre pontos de melhoria, um plano de ação, novas ideias, soluções para problemas específicos..." class="w-full px-4 py-3 rounded-lg border focus:outline-none"></textarea>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="consultancy_expectations">✨ Personalizar consultoria com IA</button>
                                        <button type="button" class="sentiment-btn mt-2 ml-2" data-field="consultancy_expectations">🎭 Análise de Sentimento</button>
                                    </div>
                                    <div>
                                        <label for="growth_target" class="block text-sm font-medium mb-2">Meta de crescimento esperada para o próximo ano *</label>
                                        <select id="growth_target" name="growth_target" required class="w-full px-4 py-3 rounded-lg border focus:outline-none">
                                            <option value="">Selecione a meta de crescimento</option>
                                            <option value="manutencao">Manter posição atual / Estabilidade</option>
                                            <option value="crescimento_moderado">Crescimento moderado (até 10-20%)</option>
                                            <option value="crescimento_acelerado">Crescimento acelerado (20-50%)</option>
                                            <option value="expansao_agressiva">Expansão agressiva (acima de 50%)</option>
                                        </select>
                                        <button type="button" class="ai-assist-btn mt-2" data-field="growth_target">✨ Plano de crescimento com IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row justify-between items-center pt-6 gap-4">
                            <button type="button" id="prev-step" class="button-secondary w-full sm:w-auto px-6 py-3 rounded-lg font-semibold" disabled>
                                ← Anterior
                            </button>
                            <button type="button" id="back-to-start" class="button-secondary w-full sm:w-auto px-6 py-3 rounded-lg font-semibold">
                                🏠 Início
                            </button>
                            <button type="button" id="next-step" class="button-primary w-full sm:w-auto px-6 py-3 rounded-lg font-semibold">
                                Próximo →
                            </button>
                            <button type="submit" id="submit-form" class="button-success w-full sm:w-auto px-8 py-3 rounded-lg font-semibold hidden">
                                🚀 Gerar Diagnóstico Completo
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="ai-chat-widget-container" class="fixed bottom-6 right-6 z-[1000]">
        <button id="ai-chat-toggle" class="w-14 h-14 bg-gradient-to-r from-purple-500 to-blue-600 rounded-full shadow-lg flex items-center justify-center text-white hover:scale-110 transition-transform focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
            <span class="text-2xl">🤖</span>
        </button>
        <div id="ai-chat-panel" class="absolute bottom-20 right-0 w-80 sm:w-96 bg-white dark:bg-gray-800 rounded-lg shadow-xl border dark:border-gray-700 hidden flex flex-col" style="max-height: 70vh;">
            <div class="p-4 border-b dark:border-gray-700 bg-gradient-to-r from-purple-500 to-blue-600 text-white rounded-t-lg">
                <h3 class="font-semibold">Assistente IA PRO</h3>
                <p class="text-sm opacity-90">Como posso ajudar?</p>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-3">
                <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg max-w-[85%] mr-auto">
                    <p class="text-sm text-gray-800 dark:text-gray-200">Olá! Sou o seu assistente PRO. Se tiver dúvidas sobre algum campo ou precisar de ajuda, é só perguntar!</p>
                </div>
            </div>
            <div class="p-4 border-t dark:border-gray-700">
                <div class="flex space-x-2">
                    <input type="text" id="chat-input" placeholder="Sua dúvida aqui..." class="flex-1 px-3 py-2 border dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <button id="send-chat" class="px-4 py-2 bg-purple-500 text-white rounded-lg text-sm hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                        Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm z-[1001] hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[85vh] overflow-hidden flex flex-col">
            <div class="p-5 border-b dark:border-gray-700 bg-gradient-to-r from-blue-500 to-purple-600 text-white">
                <div class="flex justify-between items-center">
                    <h3 id="ai-modal-title" class="text-xl font-semibold">Assistente IA PRO</h3>
                    <button id="close-ai-modal" class="text-white hover:text-gray-200 text-2xl leading-none">&times;</button>
                </div>
                <p class="text-sm opacity-90 mt-1" id="ai-modal-subtitle">Analisando o seu campo...</p>
            </div>
            <div class="p-6 flex-grow overflow-y-auto">
                <div id="ai-response" class="space-y-4 text-gray-800 dark:text-gray-200">
                    <div class="flex items-center space-x-2 text-gray-500 dark:text-gray-400">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"></div>
                        <span>A processar com IA...</span>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
                <div class="flex justify-end space-x-3">
                    <button id="apply-ai-suggestion" class="button-success px-4 py-2 rounded-lg text-sm hidden">
                        ✅ Aplicar Sugestão
                    </button>
                    <button id="close-ai-modal-btn" class="button-secondary px-4 py-2 rounded-lg text-sm">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="report-screen" class="min-h-screen p-4 md:p-6 hidden">
        <div class="max-w-6xl mx-auto">
            <div class="glass-container p-8 mb-6 text-center">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 flex items-center justify-center">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl md:text-4xl font-bold mb-4 animated-title-h1">Diagnóstico Empresarial Completo</h1>
                <p id="company-title-report" class="text-xl opacity-80 mb-2"></p>
                <p class="text-sm opacity-60">Relatório gerado em <span id="report-date"></span></p>
            </div>

            <div class="glass-container p-6 mb-6">
                <h2 class="text-2xl font-bold mb-4 flex items-center"><span class="text-2xl mr-3">📋</span>Resumo Executivo</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="text-center p-4 rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30">
                        <div class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="score-overall">0%</div>
                        <div class="text-sm font-medium mt-1">Pontuação Geral de Prontidão</div>
                    </div>
                    <div class="text-center p-4 rounded-lg bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30">
                        <div class="text-3xl font-bold text-green-600 dark:text-green-400" id="opportunities-count">0</div>
                        <div class="text-sm font-medium mt-1">Recomendações Chave</div>
                    </div>
                    <div class="text-center p-4 rounded-lg bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/30 dark:to-orange-800/30">
                        <div class="text-3xl font-bold text-orange-600 dark:text-orange-400" id="priorities-count">0</div>
                        <div class="text-sm font-medium mt-1">Áreas de Melhoria Prioritárias</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="glass-container p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center"><span class="text-xl mr-3">💪</span>Pontos Fortes Identificados</h3>
                    <div id="strengths-list" class="space-y-3"></div>
                </div>
                <div class="glass-container p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center"><span class="text-xl mr-3">🎯</span>Áreas de Melhoria Prioritárias</h3>
                    <div id="improvements-list" class="space-y-3"></div>
                </div>
            </div>

            <div class="glass-container p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 flex items-center"><span class="text-xl mr-3">🚀</span>Recomendações Estratégicas com IA</h3>
                <div id="recommendations-list" class="space-y-4"></div>
            </div>

            <div class="glass-container p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 flex items-center"><span class="text-xl mr-3">📅</span>Plano de Ação Sugerido (Próximos 90 Dias)</h3>
                <div id="action-plan" class="space-y-4"></div>
            </div>

            <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                <button id="download-report" class="button-primary px-6 py-3 rounded-lg font-semibold w-full sm:w-auto">
                    📄 Baixar Relatório PDF
                </button>
                <button id="new-analysis" class="button-secondary px-6 py-3 rounded-lg font-semibold w-full sm:w-auto">
                    🔄 Nova Análise
                </button>
                <button id="share-report" class="button-success px-6 py-3 rounded-lg font-semibold w-full sm:w-auto">
                    📤 Partilhar Resultados
                </button>
            </div>
        </div>
    </div>

<script>
    // Variáveis globais
    let currentStep = 1;
    const totalSteps = 7; // Número total de etapas no formulário
    
    // Elementos da UI
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');

    const businessFormEl = document.getElementById('business-form'); // Renomeado para evitar conflito com a variável global 'businessForm'
    const welcomeScreen = document.getElementById('welcome-screen');
    const diagnosticForm = document.getElementById('diagnostic-form');
    const reportScreen = document.getElementById('report-screen');
    
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');

    const prevStepBtn = document.getElementById('prev-step');
    const nextStepBtn = document.getElementById('next-step');
    const submitFormBtn = document.getElementById('submit-form');
    const backToStartBtn = document.getElementById('back-to-start');
    
    // --- Inicialização e Manipuladores de Eventos Principais ---
    document.addEventListener('DOMContentLoaded', () => {
        // Preferência de tema do sistema
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            enableDarkMode();
        } else {
            enableLightMode();
        }

        // Configurar ouvintes de eventos
        if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
        
        const startDiagnosticBtn = document.getElementById('start-diagnostic');
        if (startDiagnosticBtn) startDiagnosticBtn.addEventListener('click', handleStartDiagnostic);
        if (backToStartBtn) backToStartBtn.addEventListener('click', handleBackToStart);

        document.querySelectorAll('.nav-item').forEach(item => item.addEventListener('click', handleNavClick));
        document.querySelectorAll('.sector-btn').forEach(btn => btn.addEventListener('click', handleSectorSelect));
        document.querySelectorAll('.ai-assist-btn').forEach(btn => btn.addEventListener('click', handleAIAssistClick));
        document.querySelectorAll('.sentiment-btn').forEach(btn => btn.addEventListener('click', handleSentimentAnalysisClick));

        if (prevStepBtn) prevStepBtn.addEventListener('click', handlePrevStep);
        if (nextStepBtn) nextStepBtn.addEventListener('click', handleNextStep);
        if (businessFormEl) businessFormEl.addEventListener('submit', handleFormSubmit);
        
        // Botões do relatório
        const newAnalysisBtn = document.getElementById('new-analysis');
        if (newAnalysisBtn) newAnalysisBtn.addEventListener('click', handleNewAnalysis);
        const downloadReportBtn = document.getElementById('download-report');
        if (downloadReportBtn) downloadReportBtn.addEventListener('click', () => showTemporaryMessage('Funcionalidade de download do relatório em PDF será implementada em breve!'));
        const shareReportBtn = document.getElementById('share-report');
        if (shareReportBtn) shareReportBtn.addEventListener('click', handleShareReport);

        // Inicializar o estado do formulário (se já estiver visível, por exemplo, ao recarregar a página)
        if (diagnosticForm && !diagnosticForm.classList.contains('hidden')) {
            showStep(currentStep); // Garante que a etapa correta seja exibida
        } else {
            updateNavigationButtons(); // Garante que os botões de navegação estejam no estado correto para a tela de boas-vindas
        }
        
        // Animações de entrada
        setupIntersectionObserver();
        // Chat IA
        setupAIChat();
        // Modal IA
        setupAIModal();
    });

    // --- Funções de Tema ---
    function toggleTheme() {
        if (body.classList.contains('dark')) {
            enableLightMode();
            localStorage.setItem('theme', 'light');
        } else {
            enableDarkMode();
            localStorage.setItem('theme', 'dark');
        }
    }
    function enableDarkMode() {
        body.classList.remove('light');
        body.classList.add('dark');
        if(sunIcon) sunIcon.classList.add('hidden');
        if(moonIcon) moonIcon.classList.remove('hidden');
    }
    function enableLightMode() {
        body.classList.remove('dark');
        body.classList.add('light');
        if(sunIcon) sunIcon.classList.remove('hidden');
        if(moonIcon) moonIcon.classList.add('hidden');
    }

    // --- Navegação e Estado do Formulário ---
    function handleStartDiagnostic() {
        if (welcomeScreen) welcomeScreen.classList.add('hidden');
        if (diagnosticForm) diagnosticForm.classList.remove('hidden');
        currentStep = 1;
        showStep(currentStep);
    }

    function handleBackToStart() {
        if (diagnosticForm) diagnosticForm.classList.add('hidden');
        if (welcomeScreen) welcomeScreen.classList.remove('hidden');
        // Opcional: resetar o formulário se desejar
        // if (businessFormEl) businessFormEl.reset();
        // currentStep = 1;
        // updateProgressBar();
        // updateNavigationButtons();
    }

    function showStep(stepNumber) {
        document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
        const targetStep = document.querySelector(`.form-step[data-step="${stepNumber}"]`);
        if (targetStep) targetStep.classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (parseInt(item.dataset.step) === stepNumber) item.classList.add('active');
        });
        
        currentStep = stepNumber;
        updateProgressBar();
        updateNavigationButtons();
        window.scrollTo(0, 0); // Scroll para o topo ao mudar de etapa
    }

    function updateProgressBar() {
        if (progressBar && progressText) {
            const percentage = Math.max(0, (currentStep -1) / (totalSteps -1)) * 100; // Correção para progresso de 0 a 100
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `Etapa ${currentStep} de ${totalSteps}`;
        }
    }

    function updateNavigationButtons() {
        if (!prevStepBtn || !nextStepBtn || !submitFormBtn) return;

        prevStepBtn.disabled = currentStep === 1;
        prevStepBtn.style.opacity = prevStepBtn.disabled ? '0.5' : '1';
        
        if (currentStep === totalSteps) {
            nextStepBtn.classList.add('hidden');
            submitFormBtn.classList.remove('hidden');
        } else {
            nextStepBtn.classList.remove('hidden');
            submitFormBtn.classList.add('hidden');
        }
    }

    function handleNavClick(event) {
        const stepNumber = parseInt(event.currentTarget.dataset.step);
        // Permite navegação para etapas anteriores ou para a próxima se a atual for válida
        if (stepNumber < currentStep || validateCurrentStep()) {
            showStep(stepNumber);
        }
    }
    
    function handlePrevStep() {
        if (currentStep > 1) showStep(currentStep - 1);
    }

    function handleNextStep() {
        if (validateCurrentStep() && currentStep < totalSteps) {
            showStep(currentStep + 1);
        }
    }

    function handleSectorSelect(event) {
        document.querySelectorAll('.sector-btn').forEach(b => b.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        const sectorInput = document.querySelector('input[name="sector"]');
        if (sectorInput) sectorInput.value = event.currentTarget.dataset.value;
    }

    // --- Validação do Formulário ---
    function validateCurrentStep() {
        const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"]`);
        if (!currentStepElement) return false;

        let isValid = true;
        const requiredFields = currentStepElement.querySelectorAll('[required]');
        let firstInvalidField = null;
        
        requiredFields.forEach(field => {
            field.classList.remove('border-red-500', 'ring-1', 'ring-red-500'); // Limpar erros anteriores
            let fieldIsValid = true;

            if (field.type === 'hidden' && field.name === 'sector') { // Validação específica para botões de setor
                if (!field.value.trim()) fieldIsValid = false;
            } else if (field.type === 'checkbox') {
                if (!field.checked) fieldIsValid = false;
            } else if (field.type === 'radio') {
                const radioGroup = document.querySelector(`input[name="${field.name}"]:checked`);
                if (!radioGroup) fieldIsValid = false;
            } else if (!field.value || field.value.trim() === '') {
                fieldIsValid = false;
            }

            if (!fieldIsValid) {
                isValid = false;
                field.classList.add('border-red-500', 'ring-1', 'ring-red-500');
                if (!firstInvalidField) firstInvalidField = field;
            }
        });

        if (!isValid && firstInvalidField) {
            firstInvalidField.focus({ preventScroll: true }); // Foca sem scroll brusco
            // Scroll suave para o campo inválido
            firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
            showTemporaryMessage('Por favor, preencha todos os campos obrigatórios (*) antes de continuar.', 'error', 5000);
        }
        return isValid;
    }
    
    // --- Submissão do Formulário e Geração de Relatório ---
    function handleFormSubmit(event) {
        event.preventDefault();
        if (!validateCurrentStep()) return;

        const formData = new FormData(businessFormEl);
        const diagnosticData = Object.fromEntries(formData.entries());

        if (submitFormBtn) {
            const originalText = submitFormBtn.textContent;
            submitFormBtn.innerHTML = `<span class="animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white inline-block mr-2"></span> Processando...`;
            submitFormBtn.disabled = true;

            setTimeout(async () => { // Simulação de processamento
                generateReport(diagnosticData);
                showReportScreenUI();
                
                // Enviar dados para o webhook do n8n
                await sendToWebhook(diagnosticData);
                
                submitFormBtn.innerHTML = originalText; // Restaurar texto original
                submitFormBtn.disabled = false;
            }, 2500);
        }
    }

    function generateReport(data) {
        const companyTitleEl = document.getElementById('company-title-report');
        const reportDateEl = document.getElementById('report-date');
        if (companyTitleEl) companyTitleEl.textContent = `Relatório para ${data.company_name || 'a sua Empresa'}`;
        if (reportDateEl) reportDateEl.textContent = new Date().toLocaleDateString('pt-BR', { year: 'numeric', month: 'long', day: 'numeric' });
        
        const score = calculateOverallScore(data); // Renomeado para clareza
        const scoreOverallEl = document.getElementById('score-overall');
        if (scoreOverallEl) scoreOverallEl.textContent = `${score}%`;

        const strengths = generateStrengthsList(data); // Renomeado para clareza
        populateReportListUI('strengths-list', strengths, 'bg-green-50 dark:bg-green-900/30', 'bg-green-500');
        
        const improvements = generateImprovementsList(data); // Renomeado para clareza
        populateReportListUI('improvements-list', improvements, 'bg-orange-50 dark:bg-orange-900/30', 'bg-orange-500');
        const prioritiesCountEl = document.getElementById('priorities-count');
        if (prioritiesCountEl) prioritiesCountEl.textContent = improvements.length;

        const recommendations = generateRecommendationsList(data); // Renomeado para clareza
        populateReportItemsUI('recommendations-list', recommendations, 'explorar');
        const opportunitiesCountEl = document.getElementById('opportunities-count');
        if (opportunitiesCountEl) opportunitiesCountEl.textContent = recommendations.length;

        const actionPlan = generateActionPlanItems(data); // Renomeado para clareza
        populateReportItemsUI('action-plan', actionPlan, 'solucao');
    }
    
    function showReportScreenUI() {
        if (diagnosticForm) diagnosticForm.classList.add('hidden');
        if (reportScreen) reportScreen.classList.remove('hidden');
        window.scrollTo(0,0);
    }

    // --- Lógica de Geração de Conteúdo do Relatório (Exemplos) ---
    function calculateOverallScore(data) {
        let score = 50; // Pontuação base
        if (data.sector && data.sector !== 'outro') score += 5;
        if (data.company_size && (data.company_size.toLowerCase().includes('media') || data.company_size.toLowerCase().includes('grande') || parseInt(data.company_size) > 49)) score += 5;
        if (data.digitalization_level === 'avancado' || data.digitalization_level === 'muito_avancado') score += 10;
        if (data.ai_usage && !data.ai_usage.toLowerCase().includes("não utiliza") && data.ai_usage.length > 10) score += 8;
        if (data.growth_target === 'expansao_agressiva' || data.growth_target === 'crescimento_acelerado') score += 7;
        if (data.business_objectives && data.business_objectives.length > 50) score += 5;
        if (data.consultancy_expectations && data.consultancy_expectations.length > 30) score += 3;
        if (data.marketing_strategies && data.marketing_strategies.length > 30) score += 4;
        if (data.crm_usage && !data.crm_usage.toLowerCase().includes("não utiliza")) score += 3;
        return Math.min(Math.max(score, 30), 98); // Score entre 30 e 98
    }

    function generateStrengthsList(data) {
        const strengths = [];
        if (data.company_name) strengths.push(`Empresa com identidade definida: <strong>${data.company_name}</strong>.`);
        if (data.sector && data.sector !== "outro") strengths.push(`Foco setorial claro em: <strong>${data.sector.charAt(0).toUpperCase() + data.sector.slice(1)}</strong>.`);
        if (data.main_products && data.main_products.length > 30) strengths.push("Portfólio de produtos/serviços bem descrito.");
        if (data.target_audience && data.target_audience.length > 30) strengths.push("Compreensão inicial do público-alvo.");
        if (data.growth_target && data.growth_target !== "manutencao") strengths.push(`Ambição e visão de crescimento (Meta: ${data.growth_target.replace(/_/g, ' ').toLowerCase()})`);
        if (data.consultancy_expectations && data.consultancy_expectations.length > 20) strengths.push("Proatividade em buscar consultoria e melhoria contínua.");
        if (strengths.length < 2) strengths.push("Iniciativa para realizar auto-diagnóstico e identificar áreas de desenvolvimento.");
        return strengths;
    }

    function generateImprovementsList(data) {
        const improvements = [];
        if (!data.internal_processes || data.internal_processes.length < 50) improvements.push("Refinar o mapeamento e a otimização de processos internos chave.");
        if (data.operational_bottlenecks && data.operational_bottlenecks.length > 15) improvements.push(`Abordar proativamente os gargalos operacionais como: "${data.operational_bottlenecks.substring(0,40)}...".`);
        if (data.automation_opportunities && data.automation_opportunities.length > 15) improvements.push(`Explorar e implementar oportunidades de automação identificadas em: "${data.automation_opportunities.substring(0,40)}...".`);
        if (!data.marketing_strategies || data.marketing_strategies.length < 50) improvements.push("Desenvolver ou aprimorar estratégias de marketing e vendas mais robustas.");
        if (data.crm_usage && (data.crm_usage.toLowerCase().includes("não utiliza") || data.crm_usage.toLowerCase().includes("excel") || data.crm_usage.toLowerCase().includes("planilhas"))) improvements.push("Considerar a implementação ou otimização do uso de uma ferramenta de CRM dedicada.");
        if (data.financial_challenges && data.financial_challenges.length > 15) improvements.push("Desenvolver estratégias para superar os desafios financeiros mencionados.");
        if (data.hr_challenges && data.hr_challenges.length > 15) improvements.push("Fortalecer as práticas de gestão de recursos humanos e abordar os desafios da equipa.");
        if (data.digitalization_level === "basico" || data.digitalization_level === "intermediario") improvements.push("Acelerar a transformação digital e a adoção de novas tecnologias.");
        if (data.tech_challenges && data.tech_challenges.length > 15) improvements.push("Elaborar um plano para mitigar os desafios tecnológicos identificados.");
        if (improvements.length < 2) improvements.push("Identificar e priorizar áreas chave para desenvolvimento estratégico focado.");
        return improvements.slice(0, 5);
    }

    function generateRecommendationsList(data) {
        const recommendations = [];
        const icons = { perigo: '⚠️', oportunidade: '💡', desafio: '🎯', solucao: '✅', explorar: '🗺️' }; // Ícones para categorias

        if (data.digitalization_level === "basico") {
            recommendations.push({ icon: icons.oportunidade, title: "Plano de Digitalização Prioritário", description: "Iniciar um projeto focado na digitalização de 2-3 processos chave (ex: atendimento, vendas) nos próximos 90 dias. Avaliar ferramentas de baixo custo para iniciar." });
        }
        if (data.ai_usage && (data.ai_usage.toLowerCase().includes("não utiliza") || data.ai_usage.toLowerCase().includes("ainda não") || data.ai_usage.length < 20 )) {
            recommendations.push({ icon: icons.explorar, title: "Exploração Estratégica de IA", description: "Realizar um workshop interno para identificar 2-3 casos de uso de IA com potencial de ROI rápido (ex: chatbot para FAQ, análise de sentimento de feedback de clientes)." });
        }
        if (data.operational_bottlenecks && data.operational_bottlenecks.length > 10) {
            recommendations.push({ icon: icons.desafio, title: "Task-Force para Otimização de Processos", description: `Criar uma pequena equipa multifuncional para analisar e propor soluções para os principais gargalos operacionais (ex: "${data.operational_bottlenecks.substring(0,30)}...") em 60 dias.` });
        }
        if (!data.marketing_performance || data.marketing_performance.length < 50) {
             recommendations.push({ icon: icons.oportunidade, title: "Definição e Monitorização de KPIs de Marketing", description: "Estabelecer 3-5 KPIs cruciais para marketing e vendas (ex: taxa de conversão, CAC, LTV) e implementar um dashboard simples para acompanhamento semanal." });
        }
        if (data.financial_challenges && data.financial_challenges.length > 10) {
            recommendations.push({ icon: icons.perigo, title: "Análise Financeira Detalhada e Plano de Ação", description: `Contratar uma consultoria financeira breve ou dedicar tempo interno para uma análise profunda dos desafios financeiros (ex: "${data.financial_challenges.substring(0,30)}...") e criar um plano de mitigação.` });
        }
        if (recommendations.length < 2 && data.top_challenges) {
            const firstChallenge = data.top_challenges.split(/[\n,;]/)[0].trim();
            recommendations.push({ icon: icons.desafio, title: "Foco no Principal Desafio Estratégico", description: `Priorizar recursos e atenção para desenvolver uma estratégia clara para enfrentar o desafio principal identificado: "${firstChallenge.substring(0,50)}...".` });
        }
        if (recommendations.length === 0) {
            recommendations.push({ icon: icons.explorar, title: "Revisão Estratégica e Definição de Prioridades", description: "Conduzir uma sessão de planeamento estratégico para revisitar a visão da empresa, analisar o mercado e definir 3 prioridades claras para os próximos 6 meses."});
        }
        return recommendations.slice(0,4);
    }

    function generateActionPlanItems(data) {
        const actions = [];
        const icons = { perigo: '⚠️', oportunidade: '💡', desafio: '🎯', solucao: '✅', explorar: '🗺️', calendario: '🗓️' };

        actions.push({ icon: icons.calendario, title: "Reunião de Análise do Diagnóstico e Definição de Próximos Passos", description: "Agendar uma reunião com as partes interessadas chave para discutir os resultados deste diagnóstico e definir responsabilidades para as ações prioritárias.", timeline: "Próximos 7 dias" });
        
        if (data.operational_bottlenecks || data.automation_opportunities) {
             actions.push({ icon: icons.solucao, title: "Workshop de Mapeamento e Otimização de Processos (Piloto)", description: "Selecionar 1 processo crítico para um workshop de mapeamento detalhado, identificando pontos de melhoria e potencial de automação. Definir um plano piloto.", timeline: "Próximas 3 semanas" });
        }
        if (!data.marketing_strategies || data.marketing_strategies.length < 50) {
             actions.push({ icon: icons.oportunidade, title: "Sprint de Planeamento de Marketing e Vendas", description: "Realizar um sprint de 1 semana para definir/refinar 2-3 iniciativas de marketing/vendas de alto impacto para os próximos 60 dias, com metas claras e mensuráveis.", timeline: "Próximas 4 semanas" });
        }
        if (data.digitalization_level === "basico" && (!data.tools_software || data.tools_software.length < 30)) {
            actions.push({ icon: icons.explorar, title: "Pesquisa e Seleção de Ferramenta Colaborativa/Gestão", description: "Pesquisar e selecionar uma ferramenta básica (muitas vezes gratuita ou de baixo custo) para melhorar a gestão de tarefas e a comunicação da equipa. Implementar em 45 dias.", timeline: "Próximos 45 dias" });
        }
        if (actions.length < 3 && data.business_objectives) {
             actions.push({ icon: icons.desafio, title: "Tradução de Objetivos em Metas SMART", description: "Desdobrar os principais objetivos de negócio em metas SMART (Específicas, Mensuráveis, Atingíveis, Relevantes, Temporais) para as equipas/áreas responsáveis.", timeline: "Próximas 2 semanas"});
        }
        actions.push({ icon: icons.calendario, title: "Revisão de Progresso (Checkpoint 1)", description: "Agendar uma reunião de acompanhamento em 45 dias para avaliar o progresso das ações iniciais, identificar obstáculos e fazer ajustes no plano.", timeline: "Em 45 dias" });
        return actions.slice(0,4);
    }
    
    // --- Funções Auxiliares de UI do Relatório ---
    function populateReportListUI(elementId, items, itemBgClass, dotColorClass) {
        const listElement = document.getElementById(elementId);
        if (!listElement) return;
        listElement.innerHTML = ''; // Limpar conteúdo anterior
        if (items.length > 0) {
            const ul = document.createElement('ul');
            ul.className = 'space-y-2';
            items.forEach(itemText => {
                const li = document.createElement('li');
                li.className = `flex items-start space-x-3 p-3 rounded-md ${itemBgClass}`;
                li.innerHTML = `
                    <span class="flex-shrink-0 inline-block w-2 h-2 rounded-full ${dotColorClass}" style="margin-top: 0.4em;"></span>
                    <span class="text-sm">${itemText}</span>`; // innerHTML para permitir tags como <strong>
                ul.appendChild(li);
            });
            listElement.appendChild(ul);
        } else {
            listElement.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400 italic">Nenhum item específico identificado nesta categoria com base nas respostas fornecidas.</p>`;
        }
    }

    function populateReportItemsUI(elementId, items, defaultCategoryClass) {
        const listElement = document.getElementById(elementId);
        if (!listElement) return;
        listElement.innerHTML = ''; // Limpar conteúdo anterior
        if (items.length > 0) {
            items.forEach(item => {
                const div = document.createElement('div');
                // Usa a classe da categoria do item se existir, senão usa a defaultCategoryClass
                div.className = `report-item-card ${item.categoryClass || defaultCategoryClass}`; 
                div.innerHTML = `
                    <div class="report-item-icon">${item.icon || '➡️'}</div>
                    <div class="report-item-content">
                        <div class="report-item-title">${item.title} ${item.timeline ? `<span class="text-xs font-normal text-purple-600 dark:text-purple-400 ml-2">(${item.timeline})</span>` : ''}</div>
                        <div class="report-item-description">${item.description}</div>
                    </div>`;
                listElement.appendChild(div);
            });
        } else {
            listElement.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400 italic">Nenhuma informação específica gerada para esta secção.</p>`;
        }
    }
    
    // --- Botões do Relatório ---
    function handleNewAnalysis() {
        if (reportScreen) reportScreen.classList.add('hidden');
        if (businessFormEl) {
            businessFormEl.reset();
            // Limpar classes de erro dos campos
            businessFormEl.querySelectorAll('.border-red-500').forEach(el => el.classList.remove('border-red-500', 'ring-1', 'ring-red-500'));
        }
        document.querySelectorAll('.sector-btn.selected').forEach(btn => btn.classList.remove('selected'));
        document.querySelectorAll('.sentiment-result').forEach(el => el.remove());

        if (welcomeScreen) welcomeScreen.classList.remove('hidden');
        currentStep = 1;
        showStep(1); // Mostra a primeira etapa do formulário
        window.scrollTo(0,0);
    }

    function handleShareReport() {
        const reportTitle = document.getElementById('company-title-report')?.textContent || "Diagnóstico Empresarial";
        const reportScore = document.getElementById('score-overall')?.textContent || "";
        const shareData = {
            title: `Resultado: ${reportTitle}`,
            text: `Concluí o Diagnóstico Empresarial Inteligente PRO! Pontuação Geral: ${reportScore}. Confira as principais recomendações.`,
            url: window.location.href // Ou um link para uma versão online/compartilhável do relatório
        };
        if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
            navigator.share(shareData)
                .then(() => showTemporaryMessage('Relatório partilhado com sucesso!'))
                .catch(err => {
                    console.error('Erro ao partilhar:', err);
                    showTemporaryMessage('Não foi possível partilhar automaticamente. Pode copiar o link.', 'error');
                });
        } else {
            // Fallback para copiar link ou mostrar mensagem
            try {
                navigator.clipboard.writeText(window.location.href);
                showTemporaryMessage('Link do relatório copiado para a área de transferência!');
            } catch (err) {
                showTemporaryMessage('Partilha não suportada neste navegador. Tente copiar o link da página.', 'error');
            }
        }
    }

    // --- Funcionalidades de IA (Chat e Modal de Campo) ---
    let currentAIInteractionField = null; // Para o modal de IA de campo

    function setupAIChat() {
        const aiChatToggleBtn = document.getElementById('ai-chat-toggle');
        const aiChatPanel = document.getElementById('ai-chat-panel');
        const sendChatBtn = document.getElementById('send-chat');
        const chatInputEl = document.getElementById('chat-input');

        if (aiChatToggleBtn && aiChatPanel) {
            aiChatToggleBtn.addEventListener('click', () => aiChatPanel.classList.toggle('hidden'));
        }
        if (sendChatBtn && chatInputEl) {
            sendChatBtn.addEventListener('click', () => handleSendChatMessage(chatInputEl));
            chatInputEl.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSendChatMessage(chatInputEl); });
        }
    }
    
    function handleSendChatMessage(inputElement) {
        const message = inputElement.value.trim();
        if (message) {
            addMessageToChatUI(message, 'user');
            inputElement.value = '';
            // Simular resposta da IA
            setTimeout(() => {
                const response = getAIChatResponseForMessage(message); // Renomeado
                addMessageToChatUI(response, 'ai');
            }, 1200);
        }
    }

    function addMessageToChatUI(message, sender) {
        const chatMessagesDiv = document.getElementById('chat-messages');
        if (!chatMessagesDiv) return;

        const messageDiv = document.createElement('div');
        messageDiv.classList.add('p-3', 'rounded-lg', 'text-sm', 'max-w-[85%]', 'mb-2', 'break-words');
        if (sender === 'user') {
            messageDiv.classList.add('bg-purple-100', 'dark:bg-purple-700', 'ml-auto', 'text-right', 'text-gray-800', 'dark:text-gray-200');
            messageDiv.innerHTML = `<strong>Você:</strong> ${message}`;
        } else {
            messageDiv.classList.add('bg-blue-100', 'dark:bg-blue-700', 'mr-auto', 'text-gray-800', 'dark:text-gray-200');
            messageDiv.innerHTML = `<strong>Assistente IA:</strong> ${message}`;
        }
        chatMessagesDiv.appendChild(messageDiv);
        chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Auto-scroll
    }

    function getAIChatResponseForMessage(message) {
        const originalMessage = message;
        message = message.toLowerCase();
        
        // Saudações
        if (message.includes("olá") || message.includes("oi") || message.includes("bom dia") || message.includes("boa tarde") || message.includes("boa noite")) {
            return "Olá! 👋 Sou o seu assistente de diagnóstico empresarial. Como posso ajudá-lo hoje? Posso esclarecer dúvidas sobre qualquer secção do formulário ou dar sugestões específicas para o seu negócio.";
        }
        
        // Perguntas sobre etapas específicas
        if (message.includes("geral") || message.includes("empresa") || message.includes("nome") || message.includes("setor")) {
            return "📊 **Informações Gerais**: Esta secção é fundamental! Dicas importantes:\n\n• **Nome da empresa**: Use algo memorável que reflita a sua marca\n• **Setor**: Escolha o mais específico possível para análises precisas\n• **Tamanho**: Seja preciso no número de funcionários\n• **Produtos/Serviços**: Foque nos 2-3 principais que geram mais receita\n\nPrecisa de ajuda com algum campo específico?";
        }
        
        if (message.includes("processo") || message.includes("fluxo") || message.includes("operação")) {
            return "⚙️ **Processos Operacionais**: Aqui analisamos a eficiência! Dicas:\n\n• **Fluxos principais**: Mapeie desde o pedido até a entrega\n• **Ferramentas**: Liste todos os softwares que usa diariamente\n• **Gargalos**: Identifique onde o trabalho 'emperra'\n• **Automação**: Pense em tarefas repetitivas que consome tempo\n\nQual processo específico quer otimizar?";
        }
        
        if (message.includes("marketing") || message.includes("cliente") || message.includes("vendas") || message.includes("publicidade")) {
            return "📈 **Marketing e Vendas**: Vamos potenciar a sua presença! Estratégias:\n\n• **Canais digitais**: Redes sociais, site, email marketing\n• **Métricas**: ROI, conversão, custo por lead\n• **Público-alvo**: Defina personas específicas\n• **CRM**: Fundamental para acompanhar leads\n\nEm que canal quer focar mais?";
        }
        
        if (message.includes("financeiro") || message.includes("dinheiro") || message.includes("custo") || message.includes("receita") || message.includes("lucro")) {
            return "💰 **Gestão Financeira**: A base do sucesso! Pontos-chave:\n\n• **Controlo de custos**: Identifique os maiores gastos\n• **Diversificação**: Múltiplas fontes de receita\n• **Fluxo de caixa**: Previsibilidade é essencial\n• **Ferramentas**: Use software de gestão financeira\n\nQual o seu maior desafio financeiro atual?";
        }
        
        if (message.includes("rh") || message.includes("recursos humanos") || message.includes("funcionário") || message.includes("equipa") || message.includes("pessoal")) {
            return "👥 **Recursos Humanos**: Pessoas são o ativo mais valioso! Focos:\n\n• **Recrutamento**: Processos claros e eficientes\n• **Avaliação**: Feedback regular e construtivo\n• **Desenvolvimento**: Investir em formação\n• **Retenção**: Ambiente positivo e reconhecimento\n\nComo está a satisfação da sua equipa?";
        }
        
        if (message.includes("tecnologia") || message.includes("digital") || message.includes("ia") || message.includes("inteligência artificial") || message.includes("software")) {
            return "🔧 **Tecnologia e Inovação**: O futuro é digital! Oportunidades:\n\n• **Digitalização**: Automatize processos manuais\n• **IA**: Chatbots, análise de dados, previsões\n• **Integração**: Conecte todos os sistemas\n• **Segurança**: Proteja dados e sistemas\n\nQue processo quer digitalizar primeiro?";
        }
        
        if (message.includes("objetivo") || message.includes("meta") || message.includes("crescimento") || message.includes("futuro")) {
            return "🎯 **Objetivos e Crescimento**: Vamos definir o caminho! Estratégias:\n\n• **Metas SMART**: Específicas, mensuráveis, atingíveis\n• **Prazos**: Curto (3 meses), médio (1 ano), longo (3+ anos)\n• **KPIs**: Métricas para acompanhar progresso\n• **Recursos**: O que precisa para atingir objetivos\n\nQual o seu principal objetivo para 2024?";
        }
        
        // Perguntas sobre funcionalidades
        if (message.includes("como") && (message.includes("funciona") || message.includes("usar") || message.includes("preencher"))) {
            return "🤖 **Como usar o diagnóstico**:\n\n1. **Navegação**: Use a barra lateral para saltar entre secções\n2. **Botões IA**: Clique em '✨ Sugestão com IA' para dicas personalizadas\n3. **Análise de Sentimento**: Use '🎭' para analisar o tom das suas respostas\n4. **Progresso**: Acompanhe na barra superior\n5. **Chat**: Estou sempre aqui para ajudar!\n\nQual funcionalidade quer explorar?";
        }
        
        // Perguntas sobre IA
        if (message.includes("ia") || message.includes("inteligência") || message.includes("sugestão") || message.includes("recomendação")) {
            return "🧠 **Sobre as funcionalidades de IA**:\n\n• **Sugestões personalizadas**: Baseadas no seu setor e contexto\n• **Análise de sentimento**: Identifica tom positivo/negativo\n• **Chat inteligente**: Respostas contextuais em tempo real\n• **Recomendações**: Estratégias específicas para cada área\n\nA IA adapta-se ao seu perfil empresarial. Experimente os botões ✨ em cada campo!";
        }
        
        // Problemas ou dificuldades
        if (message.includes("problema") || message.includes("dificuldade") || message.includes("não sei") || message.includes("dúvida")) {
            const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"] h3`);
            const stepTitle = currentStepElement ? currentStepElement.textContent.match(/\d+\.\s*(.*)/)[1] : "etapa atual";
            return `🆘 **Precisa de ajuda?** Estou aqui para isso!\n\nNa secção "${stepTitle}":\n• Use os botões ✨ para sugestões específicas\n• Seja o mais detalhado possível\n• Pense no impacto no seu negócio\n• Não há respostas certas ou erradas\n\nQual campo específico está a causar dificuldade?`;
        }
        
        // Agradecimentos
        if (message.includes("obrigado") || message.includes("obrigada") || message.includes("valeu") || message.includes("thanks")) {
            return "😊 De nada! Fico feliz em ajudar. Lembre-se: quanto mais detalhado for nas respostas, mais personalizado será o seu diagnóstico final. Continue com confiança!";
        }
        
        // Perguntas sobre resultados
        if (message.includes("resultado") || message.includes("relatório") || message.includes("diagnóstico") || message.includes("análise")) {
            return "📋 **Sobre o diagnóstico final**:\n\nApós completar todas as secções, receberá:\n• **Análise detalhada** de cada área\n• **Pontos fortes** identificados\n• **Oportunidades** de melhoria\n• **Recomendações específicas** com IA\n• **Plano de ação** prioritário\n\nO relatório será personalizado com base nas suas respostas!";
        }
        
        // Contexto da etapa atual
        if (message.includes("ajuda") || message.includes("help")) {
            const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"] h3`);
            const stepTitle = currentStepElement ? currentStepElement.textContent.match(/\d+\.\s*(.*)/)[1] : "etapa atual";
            return `💡 **Ajuda para "${stepTitle}"**:\n\nDicas específicas:\n• Seja específico e detalhado\n• Pense no impacto real no negócio\n• Use os botões ✨ para sugestões\n• Considere tendências do seu setor\n\nEm que posso ajudar especificamente?`;
        }
        
        // Respostas inteligentes baseadas em palavras-chave
        const keywordResponses = {
            "automação": "🤖 Automação é fundamental! Identifique tarefas repetitivas: emails, relatórios, entrada de dados. Comece pelo que consome mais tempo.",
            "concorrência": "🏆 Análise competitiva é crucial! Estude preços, serviços, marketing dos concorrentes. Encontre o seu diferencial único.",
            "inovação": "💡 Inovação não é só tecnologia! Pode ser novo processo, serviço, forma de atendimento. O que os clientes realmente precisam?",
            "produtividade": "⚡ Para aumentar produtividade: elimine reuniões desnecessárias, automatize tarefas, use ferramentas certas, defina prioridades claras.",
            "qualidade": "⭐ Qualidade é diferencial! Implemente controles, colete feedback, treine equipa, monitore indicadores. Cliente satisfeito volta sempre.",
            "vendas": "💼 Para aumentar vendas: conheça bem o cliente, melhore follow-up, use CRM, treine equipa, otimize funil de vendas.",
            "custos": "💸 Controlo de custos: categorize gastos, negocie fornecedores, elimine desperdícios, monitore mensalmente, invista no que gera retorno."
        };
        
        for (const [keyword, response] of Object.entries(keywordResponses)) {
            if (message.includes(keyword)) {
                return response;
            }
        }
        
        // Respostas contextuais mais inteligentes
        const smartResponses = [
            `Interessante perspectiva! Para o seu contexto específico, recomendo focar em: 1) Identificar o impacto real no negócio, 2) Considerar recursos disponíveis, 3) Definir métricas de sucesso. Quer explorar algum destes pontos?`,
            `Boa questão! No seu setor, isso é particularmente relevante. Sugiro: analisar casos de sucesso similares, avaliar ROI potencial, e começar com um piloto pequeno. Precisa de exemplos específicos?`,
            `Entendo a sua preocupação. Baseado na minha experiência, empresas similares resolveram isso através de: planejamento estruturado, envolvimento da equipa, e implementação gradual. Quer que detalhe alguma estratégia?`,
            `Excelente ponto! Para maximizar resultados, considere: 1) Alinhar com objetivos estratégicos, 2) Envolver stakeholders chave, 3) Medir progresso regularmente. Em qual área quer focar primeiro?`,
            `Muito relevante para o diagnóstico! Recomendo documentar: situação atual, objetivos desejados, recursos necessários, e cronograma realista. Posso ajudar a estruturar algum destes elementos?`
        ];
        
        return smartResponses[Math.floor(Math.random() * smartResponses.length)];
    }

    function setupAIModal() {
        const aiModal = document.getElementById('ai-modal');
        const closeAIModalXBtn = document.getElementById('close-ai-modal');
        const closeAIModalBottomBtn = document.getElementById('close-ai-modal-btn');
        const applyAISuggestionBtn = document.getElementById('apply-ai-suggestion');

        if (closeAIModalXBtn) closeAIModalXBtn.addEventListener('click', closeAIFieldModal);
        if (closeAIModalBottomBtn) closeAIModalBottomBtn.addEventListener('click', closeAIFieldModal);
        if (applyAISuggestionBtn) applyAISuggestionBtn.addEventListener('click', applyAIFieldSuggestion);
    }
    
    function handleAIAssistClick(event) {
        const fieldName = event.currentTarget.dataset.field;
        openAIFieldModal(fieldName);
    }
    
    function openAIFieldModal(fieldName) {
        currentAIInteractionField = fieldName;
        const fieldElement = document.querySelector(`[name="${fieldName}"]`);
        let fieldLabelText = fieldName; // Fallback

        if (fieldElement) {
            const label = document.querySelector(`label[for="${fieldElement.id}"]`);
            if (label) fieldLabelText = label.textContent.replace('*','').trim();
        }
        
        const aiModal = document.getElementById('ai-modal');
        const aiModalSubtitle = document.getElementById('ai-modal-subtitle');
        const aiResponseDiv = document.getElementById('ai-response');
        const applyBtn = document.getElementById('apply-ai-suggestion');

        if (aiModalSubtitle) aiModalSubtitle.textContent = `Assistência IA para: ${fieldLabelText}`;
        if (aiResponseDiv) aiResponseDiv.innerHTML = `<div class="flex items-center space-x-2 text-gray-500 dark:text-gray-400"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"></div><span>A obter sugestão da IA para ${fieldLabelText}...</span></div>`;
        if (applyBtn) applyBtn.classList.add('hidden');
        if (aiModal) aiModal.classList.remove('hidden');

        setTimeout(() => { // Simular chamada à API da IA
            const suggestion = getAISuggestionForField(fieldName, fieldElement ? fieldElement.value : "");
            if (aiResponseDiv) aiResponseDiv.innerHTML = `<p class="text-sm">${suggestion}</p>`;
            if (applyBtn && fieldElement && (fieldElement.tagName === 'INPUT' || fieldElement.tagName === 'TEXTAREA')) {
                applyBtn.classList.remove('hidden');
            }
        }, 1500);
    }

    function closeAIFieldModal() {
        const aiModal = document.getElementById('ai-modal');
        if (aiModal) aiModal.classList.add('hidden');
        currentAIInteractionField = null;
    }

    function applyAIFieldSuggestion() {
        const aiResponseDiv = document.getElementById('ai-response');
        if (currentAIInteractionField && aiResponseDiv) {
            const field = document.querySelector(`[name="${currentAIInteractionField}"]`);
            const suggestionText = aiResponseDiv.querySelector('p')?.textContent; // Pega o texto da sugestão
            if (field && suggestionText && (field.tagName === 'INPUT' || field.tagName === 'TEXTAREA')) {
                field.value = suggestionText;
                field.focus(); // Focar no campo após aplicar
            }
        }
        closeAIFieldModal();
    }

    function getAISuggestionForField(fieldName, currentValue) {
        // Lógica de sugestões mais elaborada
        const baseSuggestions = {
            company_name: `Para o nome da empresa, pense em algo que seja memorável, reflita a sua marca e, se possível, indique o seu nicho. Ex: "InovaTech Soluções", "Sabor & Arte Confeitaria". Se já tem um, ótimo!`,
            sector: `Escolher o setor correto ajuda a direcionar a análise. Se for "Outro", tente descrever brevemente o seu nicho no campo de produtos/serviços.`,
            company_size: `O porte da empresa influencia as estratégias. Seja o mais preciso possível. "Ex: 1-9" para micro, "10-49" para pequena, etc.`,
            main_products: `Liste os 2-3 produtos ou serviços que geram mais receita ou que são o foco da sua empresa. Ex: "Consultoria de Marketing Digital, Desenvolvimento de Websites, Gestão de Redes Sociais".`,
            target_audience: `Descreva o seu cliente ideal. Ex: "Pequenas e médias empresas do setor de varejo que buscam aumentar a sua presença online." Considere idade, interesses, problemas que resolve.`,
            internal_processes: `Pense nos fluxos de trabalho mais comuns. Ex: "Recebimento do pedido > Produção > Controlo de Qualidade > Embalagem > Envio > Pós-venda". Tente identificar 2-3 processos chave.`,
            tools_software: `Quais programas ou plataformas são essenciais no seu dia a dia? Ex: "CRM (Pipedrive), Email (Gmail), Comunicação (Slack), Gestão de Projetos (Asana), Finanças (Excel)".`,
            operational_bottlenecks: `Onde é que o trabalho "emperra"? Ex: "Aprovação de orçamentos muito demorada", "Falta de comunicação entre departamentos", "Sistema de inventário desatualizado".`,
            automation_opportunities: `Que tarefas manuais e repetitivas consomem muito tempo? Ex: "Enviar emails de follow-up", "Gerar relatórios semanais de vendas", "Copiar dados entre planilhas".`,
            
            // Marketing
            marketingChannels: `Liste todos os canais que utiliza atualmente. Ex: "Instagram, Facebook, LinkedIn, Google Ads, Email Marketing, Site próprio, Vendas diretas, Parcerias com influencers". Inclua tanto digitais quanto tradicionais.`,
            marketingStrategies: `Descreva as suas estratégias principais. Ex: "Conteúdo educativo no Instagram, Email marketing semanal, SEO no site, Campanhas pagas no Google, Networking em eventos do setor". Foque nas que geram mais resultados.`,
            salesPerformance: `Seja específico com métricas. Ex: "ROI de 3:1 no Google Ads, 15% de conversão no email, 500 seguidores/mês no Instagram, 20% do tráfego vem do SEO". Inclua desafios como "baixa conversão" ou "custo alto por lead".`,
            crmUsed: `Se usa CRM, mencione qual e como. Ex: "HubSpot para leads, Pipedrive para vendas, WhatsApp Business para atendimento". Se não usa, explique como acompanha clientes: "Planilha Excel, agenda no celular".`,
            marketing_channels: `Liste todos os canais que utiliza atualmente. Ex: "Instagram, Facebook, LinkedIn, Google Ads, Email Marketing, Site próprio, Vendas diretas, Parcerias com influencers". Inclua tanto digitais quanto tradicionais.`,
            marketing_strategies: `Descreva as suas estratégias principais. Ex: "Conteúdo educativo no Instagram, Email marketing semanal, SEO no site, Campanhas pagas no Google, Networking em eventos do setor". Foque nas que geram mais resultados.`,
            marketing_performance: `Seja específico com métricas. Ex: "ROI de 3:1 no Google Ads, 15% de conversão no email, 500 seguidores/mês no Instagram, 20% do tráfego vem do SEO". Inclua desafios como "baixa conversão" ou "custo alto por lead".`,
            crm_usage: `Se usa CRM, mencione qual e como. Ex: "HubSpot para leads, Pipedrive para vendas, WhatsApp Business para atendimento". Se não usa, explique como acompanha clientes: "Planilha Excel, agenda no celular".`,
            
            // Financeiro
            mainExpenses: `Categorize os principais custos. Ex: "Folha de pagamento (40%), Aluguel (15%), Marketing (10%), Fornecedores (20%), Tecnologia (5%)". Identifique os que mais impactam o orçamento.`,
            revenueSources: `Liste todas as fontes de receita. Ex: "Vendas diretas (60%), Assinaturas mensais (25%), Consultorias (10%), Cursos online (5%)". Indique a % de cada uma se possível.`,
            financialChallenges: `Seja honesto sobre os desafios. Ex: "Fluxo de caixa irregular, Sazonalidade nas vendas, Inadimplência de 8%, Custos fixos altos, Dificuldade para precificar". Priorize os mais críticos.`,
            financialTools: `Mencione todas as ferramentas. Ex: "Conta Azul para faturamento, Excel para controlo, Banco digital para pagamentos, PagSeguro para recebimentos". Inclua limitações se houver.`,
            main_expenses: `Categorize os principais custos. Ex: "Folha de pagamento (40%), Aluguel (15%), Marketing (10%), Fornecedores (20%), Tecnologia (5%)". Identifique os que mais impactam o orçamento.`,
            revenue_sources: `Liste todas as fontes de receita. Ex: "Vendas diretas (60%), Assinaturas mensais (25%), Consultorias (10%), Cursos online (5%)". Indique a % de cada uma se possível.`,
            financial_challenges: `Seja honesto sobre os desafios. Ex: "Fluxo de caixa irregular, Sazonalidade nas vendas, Inadimplência de 8%, Custos fixos altos, Dificuldade para precificar". Priorize os mais críticos.`,
            financial_tools: `Mencione todas as ferramentas. Ex: "Conta Azul para faturamento, Excel para controlo, Banco digital para pagamentos, PagSeguro para recebimentos". Inclua limitações se houver.`,
            
            // RH
            recruitment_process: `Descreva como recruta. Ex: "LinkedIn, indicações, site de empregos, processo: triagem > entrevista > teste prático > contratação". Inclua tempo médio e desafios.`,
            performance_evaluation: `Como avalia a equipa? Ex: "Reuniões mensais 1:1, Metas trimestrais, Feedback 360°, Avaliação anual com aumento salarial". Se não tem processo formal, mencione.`,
            hr_challenges: `Principais dificuldades com pessoas. Ex: "Alta rotatividade, Dificuldade para encontrar talentos, Motivação da equipa, Comunicação entre departamentos, Falta de plano de carreira".`,
            hr_software: `Ferramentas de RH que usa. Ex: "Gupy para recrutamento, Factorial para gestão, Slack para comunicação, Google Workspace para colaboração". Se usa planilhas, mencione.`,
            
            // Tecnologia
            digitalizationLevel: `Avalie honestamente. Baixo: processos manuais, papel. Médio: alguns sistemas, mas desconectados. Alto: processos digitais integrados, automação, dados centralizados.`,
            aiUsage: `Seja específico sobre IA. Ex: "ChatGPT para textos, Canva Magic para design, chatbot no site, análise de dados com IA". Se não usa, mencione interesse: "Queremos explorar chatbots".`,
            techChallenges: `Problemas tecnológicos reais. Ex: "Sistemas não conversam entre si, Dados espalhados, Segurança fraca, Equipa sem conhecimento técnico, Orçamento limitado para tecnologia".`,
            tech_budget: `Seja realista sobre investimento. Considere: necessidades atuais, ROI esperado, capacidade financeira, urgência das melhorias. Baixo não é problema se bem justificado.`,
            digitalization_level: `Avalie honestamente. Baixo: processos manuais, papel. Médio: alguns sistemas, mas desconectados. Alto: processos digitais integrados, automação, dados centralizados.`,
            ai_usage: `Seja específico sobre IA. Ex: "ChatGPT para textos, Canva Magic para design, chatbot no site, análise de dados com IA". Se não usa, mencione interesse: "Queremos explorar chatbots".`,
            tech_challenges: `Problemas tecnológicos reais. Ex: "Sistemas não conversam entre si, Dados espalhados, Segurança fraca, Equipa sem conhecimento técnico, Orçamento limitado para tecnologia".`,
            
            // Objetivos
            business_objectives: `Metas específicas e mensuráveis. Ex: "Aumentar faturamento em 30% em 12 meses, Lançar 2 novos produtos, Abrir filial em SP, Atingir 10k seguidores, Reduzir custos em 15%". Inclua prazos.`,
            growth_timeline: `Cronograma realista. Ex: "3 meses: novo site, 6 meses: equipa de vendas, 12 meses: expansão geográfica". Considere recursos disponíveis e prioridades.`,
            success_metrics: `Como vai medir sucesso? Ex: "Receita mensal, NPS dos clientes, Número de leads, Margem de lucro, Produtividade da equipa". Defina metas numéricas específicas.`,
            
            default: `Para este campo, tente fornecer informações claras e concisas. Pense em como isso impacta o seu negócio e os seus objetivos.`
        };
        let suggestion = baseSuggestions[fieldName] || baseSuggestions.default;
        if (currentValue && currentValue.length > 10) {
            suggestion += ` <br><br><em>Você já preencheu: "${currentValue.substring(0, 50)}...". A IA pode ajudar a refinar ou expandir isso.</em>`;
        }
        return suggestion;
    }

    // --- Análise de Sentimento ---
    function handleSentimentAnalysisClick(event) {
        const fieldName = event.currentTarget.dataset.field;
        const field = document.querySelector(`[name="${fieldName}"]`);
        if (field && field.value.trim()) {
            const text = field.value.trim();
            // Simulação de chamada à API de sentimento
            showTemporaryMessage(`A analisar sentimento para "${fieldName.replace(/_/g, ' ')}"...`, 'info', 1500);
            setTimeout(() => {
                const sentiment = getSentimentForText(text); // Renomeado
                displaySentimentResult(field, sentiment, fieldName);
            }, 1800);
        } else {
            showTemporaryMessage('Por favor, preencha o campo antes de fazer a análise de sentimento.', 'warning');
        }
    }

    function getSentimentForText(text) { // Renomeado
        const positiveWords = ['bom', 'ótimo', 'excelente', 'sucesso', 'crescimento', 'oportunidade', 'eficiente', 'qualidade', 'lucro', 'positivo', 'ideal', 'feliz', 'satisfeito', 'resolver', 'melhorar', 'inovar'];
        const negativeWords = ['problema', 'dificuldade', 'desafio', 'ruim', 'péssimo', 'falha', 'erro', 'prejuízo', 'lento', 'negativo', 'baixo', 'insatisfeito', 'preocupado', 'gargalo', 'custo alto'];
        
        const words = text.toLowerCase().match(/\b(\w+)\b/g) || []; // Apenas palavras
        let score = 0;
        words.forEach(word => {
            if (positiveWords.includes(word)) score++;
            if (negativeWords.includes(word)) score--;
        });

        if (score > 1) return { label: 'Muito Positivo', emoji: '😃', class: 'bg-green-100 dark:bg-green-800/50 text-green-700 dark:text-green-300', description: 'O texto expressa um forte otimismo e potencial.' };
        if (score === 1) return { label: 'Positivo', emoji: '😊', class: 'bg-green-100 dark:bg-green-800/50 text-green-700 dark:text-green-300', description: 'O texto demonstra uma perspectiva construtiva.' };
        if (score < -1) return { label: 'Muito Negativo', emoji: '😟', class: 'bg-red-100 dark:bg-red-800/50 text-red-700 dark:text-red-300', description: 'O texto indica fortes preocupações ou desafios significativos.' };
        if (score === -1) return { label: 'Negativo', emoji: '😕', class: 'bg-red-100 dark:bg-red-800/50 text-red-700 dark:text-red-300', description: 'O texto aponta para áreas que podem precisar de atenção.' };
        return { label: 'Neutro', emoji: '😐', class: 'bg-gray-100 dark:bg-gray-700/50 text-gray-700 dark:text-gray-300', description: 'O texto apresenta um tom equilibrado ou não possui uma carga sentimental clara.' };
    }

    function displaySentimentResult(fieldElement, sentiment, fieldName) {
        const resultDivId = `sentiment-result-${fieldName}`;
        let resultDiv = document.getElementById(resultDivId);
        if (!resultDiv) {
            resultDiv = document.createElement('div');
            resultDiv.id = resultDivId;
            resultDiv.classList.add('mt-2', 'p-3', 'rounded-lg', 'sentiment-result', 'transition-all', 'duration-300', 'ease-in-out');
            // Inserir após o último botão daquele campo (seja AI assist ou sentiment)
            const parentDiv = fieldElement.closest('div');
            const buttonsInDiv = parentDiv.querySelectorAll('button');
            if (buttonsInDiv.length > 0) {
                buttonsInDiv[buttonsInDiv.length -1].insertAdjacentElement('afterend', resultDiv);
            } else {
                 fieldElement.insertAdjacentElement('afterend', resultDiv);
            }
        }
        
        resultDiv.className = `mt-2 p-3 rounded-lg sentiment-result transition-all duration-300 ease-in-out text-sm ${sentiment.class}`;
        resultDiv.innerHTML = `
            <p class="font-medium flex items-center"><span class="text-xl mr-2">${sentiment.emoji}</span> Análise de Sentimento: ${sentiment.label}</p>
            <p class="text-xs mt-1 opacity-80">${sentiment.description}</p>
        `;
        // Forçar reflow para reiniciar a animação se a classe mudar
        void resultDiv.offsetWidth;
        resultDiv.style.opacity = '1';
        resultDiv.style.transform = 'translateY(0)';
    }

    // --- Animações de Entrada ---
    function setupIntersectionObserver() {
        const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -30px 0px' };
        const observer = new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                    obs.unobserve(entry.target); // Animar apenas uma vez
                }
            });
        }, observerOptions);

        document.querySelectorAll('.glass-container, .form-step > div > div > div, .report-item-card').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
            observer.observe(el);
        });
    }
    
    // --- Webhook Integration ---
    async function sendToWebhook(formData) {
        try {
            const webhookData = {
                user_name: formData.user_name,
                user_whatsapp: formData.user_whatsapp,
                company_name: formData.company_name,
                sector: formData.sector,
                company_size: formData.company_size,
                main_products: formData.main_products,
                target_audience: formData.target_audience,
                submitted_at: new Date().toISOString(),
                form_data: formData // Dados completos do formulário
            };

            const response = await fetch('https://webhook.n8n.alifa.com.br/webhook/ia_analizer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(webhookData)
            });

            if (response.ok) {
                console.log('Dados enviados com sucesso para o webhook');
                showTemporaryMessage('Relatório será enviado para seu WhatsApp em breve!', 'success');
            } else {
                console.error('Erro ao enviar dados para o webhook:', response.status);
                showTemporaryMessage('Erro ao processar envio. Tente novamente.', 'error');
            }
        } catch (error) {
            console.error('Erro na requisição para o webhook:', error);
            showTemporaryMessage('Erro de conexão. Verifique sua internet.', 'error');
        }
    }

    // --- Mensagens Temporárias ---
    function showTemporaryMessage(message, type = 'info', duration = 3000) {
        const existingMessage = document.querySelector('.temp-message-overlay');
        if (existingMessage) existingMessage.remove();

        const messageDiv = document.createElement('div');
        messageDiv.className = 'temp-message-overlay fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg text-white text-sm z-[2000]';
        
        if (type === 'error') messageDiv.classList.add('bg-red-500');
        else if (type === 'warning') messageDiv.classList.add('bg-yellow-500', 'text-black');
        else if (type === 'success') messageDiv.classList.add('bg-green-500');
        else messageDiv.classList.add('bg-blue-500'); // info
        
        messageDiv.textContent = message;
        document.body.appendChild(messageDiv);
        
        setTimeout(() => {
            messageDiv.style.opacity = '0';
            messageDiv.style.transform = 'translateY(-20px) translateX(-50%)'; // Animação de saída
            setTimeout(() => messageDiv.remove(), 300);
        }, duration);
    }

</script>
</body>
</html>
```

Espero que isto ajude a testar a aplicação diretamente na plataforma! Se encontrar algum problema ou tiver mais alguma questão, diga-